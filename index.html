<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8">
  <title>ğŸš’ Hydrantenkarte Hamberg/Breitenbrunn - Modulare Version</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no, maximum-scale=1.0">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <link rel="manifest" href="manifest.json">
  <meta name="theme-color" content="#d40000">
  <link rel="icon" href="icon.png" type="image/png">
  <link rel="apple-touch-icon" href="icon-192.png">
  <link rel="apple-touch-icon" sizes="192x192" href="icon-192.png">
  <link rel="apple-touch-icon" sizes="512x512" href="icon-512.png">
  
  <!-- Leaflet CSS -->
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
  
  <style>
    
    /* ========== GRUNDLEGENDE STYLES ========== */
    * { 
      box-sizing: border-box; 
      touch-action: manipulation;
    }
    
    html, body { 
      margin: 0; 
      padding: 0; 
      height: 100vh; 
      width: 100vw;
      overflow: hidden;
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Arial, sans-serif;
      background: #1a1a1a;
      color: #ffffff;
    }


    /* ========== MODE CONTAINERS ========== */
    .mode-container {
      position: fixed;
      top: 0;
      left: 0;
      width: 100vw;
      height: 100vh;
      overflow: hidden;
      transition: opacity 0.5s ease;
      z-index: 1;
    }
    
    .mode-container:not(.active) {
      opacity: 0;
      pointer-events: none;
      z-index: 0;
    }
    
    .mode-container.active {
      opacity: 1;
      pointer-events: all;
      z-index: 1;
    }


    /* ========== 2D MAP CONTAINER ========== */
    #map-container {
      background: #1a1a1a;
    }
    
    #map { 
      width: 100%;
      height: 100%;
    }


    /* ========== AR CONTAINER ========== */
    #ar-container {
      background: #000;
      position: relative;
    }
    
    #ar-video {
      width: 100%;
      height: 100%;
      object-fit: cover;
      background: #000;
    }
    
    #ar-overlays {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      pointer-events: none;
      z-index: 2;
    }
    
    /* **VERBESSERTE AR-OVERLAYS** */
    .ar-overlay {
      position: absolute;
      background: rgba(0, 0, 0, 0.8);
      color: white;
      padding: 8px 12px;
      border-radius: 15px;
      font-size: 12px;
      font-weight: 600;
      border: 2px solid;
      box-shadow: 0 2px 10px rgba(0, 0, 0, 0.5);
      transform: translate(-50%, -50%);
      min-width: 100px;
      text-align: center;
      pointer-events: auto;
      cursor: pointer;
      transition: all 0.3s ease;
      backdrop-filter: blur(5px);
    }
    
    .ar-overlay:hover {
      transform: translate(-50%, -50%) scale(1.1);
      box-shadow: 0 4px 15px rgba(0, 0, 0, 0.7);
    }
    
    .ar-overlay:active {
      transform: translate(-50%, -50%) scale(0.95);
    }
    
    
    .ar-overlay.Ã¼berflurhydrant {
      border-color: #ff4444;
      background: rgba(255, 44468, 255, 0.95);
      color: #fff;
      box-shadow: 0 0 20px #ff444466;
    }

    .ar-overlay.unterflurhydrant {
      border-color: #4444ff;
      background: rgba(4444255,68, 255, 0.95);
      color: #fff;
      box-shadow: 0 0 20px #4444ff66;
    }

    .ar-overlay.rettungspunkt {
      border-color: #44ff44;
      background: rgba(44255, 468, 255, 0.95);
      color: #fff;
      box-shadow: 0 0 20px #44ff4466;
    }

    .ar-overlay.wasserbehÃ¤lter {
      border-color: #ffff44;
      background: rgba(255, 255, 468, 255, 0.95);
      color: #000;
      box-shadow: 0 0 20px #ffff4466;
    }

    .ar-overlay.sperrpunkt {
      border-color: #ff44ff;
      background: rgba(255, 44255,68, 255, 0.95);
      color: #fff;
      box-shadow: 0 0 20px #ff44ff66;
    }
    
    /* **AR-INFO-PANEL** */
    .ar-info-panel {
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      background: rgba(0, 0, 0, 0.9);
      color: white;
      padding: 20px;
      border-radius: 15px;
      text-align: center;
      z-index: 3;
      font-size: 16px;
      max-width: 90%;
      backdrop-filter: blur(10px);
    }
    
    /* **RICHTUNGSPFEIL** */
    .ar-direction-arrow {
      animation: arrowPulse 2s infinite;
    }
    
    @keyframes arrowPulse {
      0%, 100% { opacity: 1; transform: translateX(-50%) scale(1); }
      50% { opacity: 0.7; transform: translateX(-50%) scale(1.2); }
    }


    /* ========== TITEL MIT MODE SWITCHER ========== */
    .map-title { 
      position: fixed; 
      top: 10px; 
      left: 50%; 
      transform: translateX(-50%); 
      background: rgba(0, 0, 0, 0.8); 
      backdrop-filter: blur(10px);
      color: white;
      padding: 8px 16px; 
      font-size: 16px; 
      font-weight: 600; 
      border-radius: 12px; 
      z-index: 1001;
      box-shadow: 0 2px 8px rgba(0,0,0,0.3);
      display: flex;
      align-items: center;
      gap: 16px;
      flex-direction: column;
    }
    
    .mode-switcher {
      display: flex;
      gap: 8px;
      margin-top: 8px;
    }
    
    .mode-btn {
      background: rgba(255, 255, 255, 0.1);
      border: 1px solid rgba(255, 255, 255, 0.2);
      color: white;
      padding: 6px 12px;
      border-radius: 20px;
      cursor: pointer;
      font-size: 12px;
      font-weight: 600;
      transition: all 0.3s ease;
      min-width: 80px;
    }
    
    .mode-btn:hover {
      background: rgba(255, 255, 255, 0.2);
      transform: scale(1.05);
    }
    
    .mode-btn.active {
      background: linear-gradient(135deg, #00ff88 0%, #00aaff 100%);
      color: #000;
      border-color: #00ff88;
    }


    /* ========== KONTROLLEN SIDEBAR (RECHTS) ========== */
    .controls-sidebar { 
      position: fixed; 
      right: 10px; 
      top: 50%; 
      transform: translateY(-50%);
      display: flex;
      flex-direction: column;
      gap: 8px;
      z-index: 1000;
    }
    
    .control-btn { 
      background: rgba(0, 0, 0, 0.8); 
      backdrop-filter: blur(10px);
      color: white;
      border: none;
      border-radius: 8px; 
      padding: 8px;
      cursor: pointer; 
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      transition: all 0.3s ease;
      user-select: none;
      box-shadow: 0 2px 8px rgba(0,0,0,0.3);
      min-width: 60px;
    }
    
    .control-btn .icon {
      font-size: 20px;
      margin-bottom: 2px;
    }
    
    .control-btn .label {
      font-size: 10px;
      font-weight: 600;
      white-space: nowrap;
    }
    
    .control-btn:hover { 
      background: rgba(255, 255, 255, 0.2);
      transform: scale(1.05);
      box-shadow: 0 4px 12px rgba(0,0,0,0.4);
    }
    
    .control-btn:active {
      transform: scale(0.95);
    }
    
    .control-btn.active { 
      background: #4CAF50; 
      color: white; 
    }
    
    .control-btn.blinking { 
      background: #ff9800; 
      color: white;
      animation: flashlightBlink 1s infinite;
    }
    
    @keyframes flashlightBlink {
      0%, 50% { background: #ff9800; }
      51%, 100% { background: rgba(0, 0, 0, 0.8); }
    }


    /* ========== LEGENDE (LINKS UNTEN) ========== */
    .legend-container {
      position: fixed;
      bottom: 20px;
      left: 20px;
      background: rgba(0, 0, 0, 0.85);
      backdrop-filter: blur(10px);
      border-radius: 8px;
      box-shadow: 0 4px 12px rgba(0,0,0,0.3);
      z-index: 1000;
      min-width: 200px;
      max-width: 280px;
    }
    
    .legend-header {
      padding: 10px 12px;
      font-weight: 600;
      cursor: pointer;
      border-bottom: 1px solid rgba(255,255,255,0.1);
      display: flex;
      justify-content: space-between;
      align-items: center;
      user-select: none;
    }
    
    .legend-header:hover {
      background: rgba(255,255,255,0.05);
    }
    
    .toggle-icon {
      transition: transform 0.3s ease;
      font-size: 12px;
    }
    
    .legend-content {
      padding: 10px;
      max-height: 300px;
      overflow-y: auto;
      transition: all 0.3s ease;
    }
    
    .legend-content.collapsed {
      max-height: 0;
      padding: 0 10px;
      overflow: hidden;
    }
    
    .legend-items {
      display: flex;
      flex-direction: column;
      gap: 6px;
    }
    
    .legend-item {
      display: flex;
      align-items: center;
      gap: 8px;
      padding: 4px 0;
    }
    
    .legend-color {
      width: 16px;
      height: 16px;
      border-radius: 4px;
    }
    
    .filter-checkbox {
      display: flex;
      align-items: center;
      gap: 6px;
      cursor: pointer;
      font-size: 13px;
      user-select: none;
      flex: 1;
    }
    
    .filter-checkbox:hover {
      color: #4CAF50;
    }


    /* ========== STATUS CONTAINER (RECHTS UNTEN) ========== */
    .status-container { 
      position: fixed; 
      bottom: 20px; 
      right: 10px; 
      display: flex;
      flex-direction: column;
      gap: 6px;
      z-index: 1000;
      align-items: flex-end;
    }
    
    .status-indicator { 
      background: rgba(0, 0, 0, 0.8); 
      backdrop-filter: blur(10px);
      color: white;
      padding: 6px 12px; 
      border-radius: 15px; 
      font-size: 12px; 
      font-weight: 600;
      box-shadow: 0 2px 8px rgba(0,0,0,0.3);
      white-space: nowrap;
      display: flex;
      align-items: center;
      gap: 6px;
    }
    
    /* ========== OFFLINE INDIKATOR ========== */
    .offline-indicator {
      position: fixed;
      top: 100px;
      left: 50%;
      transform: translateX(-50%);
      background: #ff9800;
      color: white;
      padding: 8px 16px;
      border-radius: 20px;
      font-size: 14px;
      font-weight: bold;
      z-index: 8000;
      display: none;
    }
    
    .offline-indicator.visible {
      display: block;
      animation: pulse 2s infinite;
    }
    
    @keyframes pulse {
      0%, 100% { transform: translateX(-50%) scale(1); }
      50% { transform: translateX(-50%) scale(1.05); }
    }


    /* ========== POPUPS ========== */
    .leaflet-popup-content-wrapper {
      background: rgba(255,255,255,0.95) !important;
      backdrop-filter: blur(10px);
      border-radius: 8px !important;
      box-shadow: 0 4px 12px rgba(0,0,0,0.2) !important;
    }
    
    .leaflet-popup-content {
      margin: 12px 16px !important;
      font-size: 13px;
      line-height: 1.4;
    }
    
    .leaflet-popup-tip {
      background: rgba(255,255,255,0.95) !important;
    }


    /* ========== MOBILE ANPASSUNGEN ========== */
    @media (max-width: 768px) {
      .map-title { 
        font-size: 14px; 
        padding: 6px 12px;
        flex-direction: column;
        gap: 8px;
      }
      
      .mode-switcher {
        gap: 6px;
        margin-top: 6px;
      }
      
      .mode-btn {
        padding: 4px 10px;
        font-size: 11px;
        min-width: 70px;
      }
      
      .controls-sidebar { 
        right: 8px; 
        gap: 6px;
      }
      
      .control-btn { 
        min-width: 55px;
        padding: 6px;
      }
      
      .control-btn .icon {
        font-size: 18px;
      }
      
      .control-btn .label {
        font-size: 9px;
      }
      
      .legend-container {
        bottom: 15px;
        left: 15px;
        max-width: 240px;
        font-size: 12px;
      }
      
      .status-container {
        bottom: 15px;
        right: 8px;
      }
      
      .status-indicator {
        font-size: 11px;
        padding: 5px 10px;
      }
      
      .ar-overlay {
        font-size: 11px;
        padding: 6px 10px;
        min-width: 80px;
      }
      
      .ar-info-panel {
        font-size: 14px;
        padding: 15px;
        max-width: 95%;
      }
    }
    
    /* Loading-Styles */
    .ar-loading, .camera-permission {
      position: fixed;
      top: 0;
      left: 0;
      width: 100vw;
      height: 100vh;
      background: rgba(0, 0, 0, 0.9);
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      color: white;
      z-index: 2000;
      text-align: center;
      padding: 20px;
    }
    
    .loading-spinner {
      border: 4px solid rgba(255, 255, 255, 0.1);
      border-left: 4px solid #00ff88;
      border-radius: 50%;
      width: 60px;
      height: 60px;
      animation: spin 1s linear infinite;
      margin-bottom: 30px;
    }
    
    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }
    
    .loading-text {
      font-size: 20px;
      font-weight: 600;
      margin-bottom: 15px;
    }
    
    .loading-steps {
      font-size: 14px;
      opacity: 0.8;
      max-width: 300px;
      line-height: 1.6;
    }
    
    .permission-icon {
      font-size: 80px;
      margin-bottom: 20px;
    }
    
    .permission-btn {
      background: linear-gradient(135deg, #00ff88 0%, #00aaff 100%);
      color: #000;
      border: none;
      padding: 15px 30px;
      border-radius: 50px;
      font-size: 16px;
      font-weight: 600;
      cursor: pointer;
      margin-top: 20px;
      transition: all 0.3s ease;
    }
    
    .permission-btn:hover {
      transform: scale(1.05);
      box-shadow: 0 6px 25px rgba(0, 255, 136, 0.5);
    }
  </style>
  
  <script>
    if ('serviceWorker' in navigator) {
      navigator.serviceWorker.register('service-worker.js').catch(console.error);
    }
  </script>
</head>

<body>
  <!-- 2D Map Container -->
  <div id="map-container" class="mode-container active">
    <div id="map"></div>
  </div>
  
  <!-- AR Container -->
  <div id="ar-container" class="mode-container">
    <video id="ar-video" autoplay playsinline muted></video>
    
    
    <div id="ar-calibration" style="display: none; position: absolute; top: 10px; left: 50%; transform: translateX(-50%); background: rgba(0,0,0,0.8); color: white; padding: 10px 20px; border-radius: 20px; font-size: 14px; z-index: 5;">
      ğŸ§­ Kalibrierung: Drehe dich langsam um 360Â° fÃ¼r bessere Genauigkeit
    </div>
    
    <div id="ar-compass" style="position: absolute; top: 20px; right: 20px; width: 60px; height: 60px; background: rgba(0,0,0,0.8); border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 24px; z-index: 4;">
      ğŸ§­
    </div>
    
    <div id="ar-overlays"></div>
    
    <div class="ar-info-panel">
      <div id="ar-hydrant-info">Richte die Kamera auf Hydranten...</div>
    </div>
  </div>
  
  <!-- Titel mit Mode Switcher -->
  <div class="map-title">
    <span>ğŸš’ Hydrantenkarte Hamberg/Breitenbrunn (52 Hydranten)</span>
    <div class="mode-switcher">
      <button class="mode-btn active" onclick="switchTo2D()" id="mode-2d-btn">
        ğŸ—ºï¸ 2D Karte
      </button>
      <button class="mode-btn" onclick="switchToSimpleAR()" id="mode-ar-btn">
        ğŸ“± GPS-AR
      </button>
    </div>
  </div>
  
  <!-- Offline Indikator -->
  <div class="offline-indicator" id="offline-indicator">
    ğŸ“¡ Offline-Modus
  </div>

  <!-- Kontrollen -->
  <div class="controls-sidebar">
    <button class="control-btn" onclick="toggleFlashlight()" id="flashlight-toggle" title="Taschenlampe">
      <span class="icon">ğŸ”¦</span>
      <span class="label" id="flashlight-label">Aus</span>
    </button>
    <button class="control-btn" onclick="findNearestHydrant()" title="NÃ¤chster Hydrant">
      <span class="icon">ğŸ”</span>
      <span class="label">NÃ¤chster</span>
    </button>
    <button class="control-btn" onclick="gotoUserLocation()" title="Meine Position">
      <span class="icon">ğŸ“</span>
      <span class="label">Position</span>
    </button>
    
    <button class="control-btn map-only" onclick="toggleTheme()" title="Karte wechseln">
      <span class="icon">ğŸ—ºï¸</span>
      <span class="label">Karte</span>
    </button>
    
    <button class="control-btn" onclick="toggleCompass()" id="compass-toggle" title="Kompass">
      <span class="icon">ğŸ§­</span>
      <span class="label">Kompass</span>
    </button>
    <button class="control-btn" onclick="toggleWindArrow()" id="wind-toggle" title="Windpfeil">
      <span class="icon">ğŸ’¨</span>
      <span class="label">Wind</span>
    </button>
    
    <button class="control-btn ar-only" onclick="toggleAROverlays()" id="overlays-btn" title="AR Overlays" style="display: none;">
      <span class="icon">ğŸ‘ï¸</span>
      <span class="label">Overlays</span>
    </button>
    
    <button class="control-btn" onclick="captureScreenshot()" title="Standort teilen">
      <span class="icon">ğŸ“¤</span>
      <span class="label">Teilen</span>
    </button>
  </div>

  
  <div class="legend-container" id="legend-container">
    <div class="legend-header" onclick="toggleLegend()">
      <span>ğŸ“‹ Legende</span>
      <span class="toggle-icon" id="legend-toggle-icon">â–¼</span>
    </div>
    <div class="legend-content" id="legend-content">
      <div class="legend-filters">
        <label class="filter-checkbox">
          <input type="checkbox" id="filter-all" checked onchange="toggleAllFilters(this)">
          <span>Alle anzeigen</span>
        </label>
      </div>
      <div class="legend-items">
        
        <div class="legend-item">
          <div class="legend-color" style="background: #ff4444;"></div>
          <label class="filter-checkbox">
            <input type="checkbox" data-type="Ã¼berflurhydrant" checked onchange="filterMarkers()">
            <span>Ãœberflurhydrant</span>
          </label>
        </div>
        <div class="legend-item">
          <div class="legend-color" style="background: #4444ff;"></div>
          <label class="filter-checkbox">
            <input type="checkbox" data-type="unterflurhydrant" checked onchange="filterMarkers()">
            <span>Unterflurhydrant</span>
          </label>
        </div>
        <div class="legend-item">
          <div class="legend-color" style="background: #44ff44;"></div>
          <label class="filter-checkbox">
            <input type="checkbox" data-type="rettungspunkt" checked onchange="filterMarkers()">
            <span>Rettungspunkt</span>
          </label>
        </div>
        <div class="legend-item">
          <div class="legend-color" style="background: #ffff44;"></div>
          <label class="filter-checkbox">
            <input type="checkbox" data-type="wasserbehÃ¤lter" checked onchange="filterMarkers()">
            <span>WasserbehÃ¤lter</span>
          </label>
        </div>
        <div class="legend-item">
          <div class="legend-color" style="background: #ff44ff;"></div>
          <label class="filter-checkbox">
            <input type="checkbox" data-type="sperrpunkt" checked onchange="filterMarkers()">
            <span>Sperrpunkt</span>
          </label>
        </div>
      </div>
    </div>
  </div>
  
  <div class="status-container">
    <div class="status-indicator" id="gps-indicator">
      <span id="gps-icon">ğŸŸ¡</span>
      <span id="gps-accuracy">GPS: --</span>
    </div>
    <div class="status-indicator" id="altitude-indicator">
      <span>ğŸ“</span>
      <span id="altitude-value">-- m</span>
    </div>
    <div class="status-indicator" id="degree-indicator">
      <span>ğŸ§­</span>
      <span id="degree-value">0Â°</span>
    </div>
    <div class="status-indicator" id="wind-indicator">
      <span>ğŸ’¨</span>
      <span id="wind-value">-- km/h</span>
    </div>
    <div class="status-indicator" id="mode-indicator">
      <span>ğŸ“±</span>
      <span id="mode-value">2D-Modus</span>
    </div>
  </div>
  
  <!-- AR Loading/Error Overlays -->
  
    <div class="ar-loading" id="ar-loading" style="display: none;">
      <div class="loading-spinner"></div>
      <div class="loading-text">ğŸ“± Starte GPS-AR...</div>
      <div class="loading-steps">
        <div id="ar-loading-step">Aktiviere Kamera...</div>
      </div>
    </div>
  
    <div class="camera-permission" id="camera-permission" style="display: none;">
      <div class="permission-icon">ğŸ“¹</div>
      <h2>Kamera-Zugriff erforderlich</h2>
      <p>FÃ¼r GPS-AR benÃ¶tigt die App Zugriff auf deine Kamera.<br>
      Dadurch kÃ¶nnen Hydranten-Informationen Ã¼ber dem Kamerabild angezeigt werden.</p>
      <button class="permission-btn" onclick="requestCameraPermission()">
        ğŸ“¸ Kamera aktivieren
      </button>
    </div>

  <!-- Leaflet JavaScript -->
  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>

  <script>
    
// ============================================================================
// GLOBAL VARIABLES
// ============================================================================
let currentMode = '2d'; // '2d' or 'ar'
let userPosition = { lat: 49.10951, lng: 11.68453 }; // Hamberg/Breitenbrunn
let currentHeading = 0;
let windData = { speed: null, direction: null, degrees: null, gusts: null };
let hydrantsData = [
  {
    "id": 0,
    "lat": 49.10951,
    "lng": 11.68453,
    "type": "Ã¼berflurhydrant",
    "description": "Ãœberflurhydrant Feuerwehrhaus",
    "size": "80.0",
    "department": "FF Hamberg",
    "color": "#ff4444",
    "icon": "icons/red-dot.png",
    "display_name": "Ãœberflurhydrant: Ãœberflurhydrant Feuerwehrhaus",
    "popup_content": "<b>Ãœberflurhydrant</b><br>ğŸ“‹ Ãœberflurhydrant Feuerwehrhaus<br>ğŸ”§ Nenndurchmesser DN: 80.0 mm<br>ğŸš’ FF Hamberg<br>ğŸ“ 49.109510, 11.684530<br><a href='https://maps.apple.com/?daddr=49.10951,11.68453' target='_blank'>ğŸ Apple Karten</a><br><a href='https://maps.google.com/?daddr=49.10951,11.68453' target='_blank'>ğŸ“± Google Maps</a>"
  },
  {
    "id": 1,
    "lat": 49.10895,
    "lng": 11.68544,
    "type": "unterflurhydrant",
    "description": "Unterflurhydrant SchÃ¶ndorfer Str. 5",
    "size": "80.0",
    "department": "FF Hamberg",
    "color": "#4444ff",
    "icon": "icons/blue-dot.png",
    "display_name": "Unterflurhydrant: Unterflurhydrant SchÃ¶ndorfer Str. 5",
    "popup_content": "<b>Unterflurhydrant</b><br>ğŸ“‹ Unterflurhydrant SchÃ¶ndorfer Str. 5<br>ğŸ”§ Nenndurchmesser DN: 80.0 mm<br>ğŸš’ FF Hamberg<br>ğŸ“ 49.108950, 11.685440<br><a href='https://maps.apple.com/?daddr=49.10895,11.68544' target='_blank'>ğŸ Apple Karten</a><br><a href='https://maps.google.com/?daddr=49.10895,11.68544' target='_blank'>ğŸ“± Google Maps</a>"
  },
  {
    "id": 2,
    "lat": 49.10803,
    "lng": 11.68614,
    "type": "unterflurhydrant",
    "description": "Unterflurhydrant Zum Spitzberg 3",
    "size": "80.0",
    "department": "FF Hamberg",
    "color": "#4444ff",
    "icon": "icons/blue-dot.png",
    "display_name": "Unterflurhydrant: Unterflurhydrant Zum Spitzberg 3",
    "popup_content": "<b>Unterflurhydrant</b><br>ğŸ“‹ Unterflurhydrant Zum Spitzberg 3<br>ğŸ”§ Nenndurchmesser DN: 80.0 mm<br>ğŸš’ FF Hamberg<br>ğŸ“ 49.108030, 11.686140<br><a href='https://maps.apple.com/?daddr=49.10803,11.68614' target='_blank'>ğŸ Apple Karten</a><br><a href='https://maps.google.com/?daddr=49.10803,11.68614' target='_blank'>ğŸ“± Google Maps</a>"
  },
  {
    "id": 3,
    "lat": 49.10752,
    "lng": 11.68542,
    "type": "unterflurhydrant",
    "description": "Unterflurhydrant Kreuzung Zum Spitzberg / RÃ¶thenweg",
    "size": "125.0",
    "department": "FF Hamberg",
    "color": "#4444ff",
    "icon": "icons/blue-dot.png",
    "display_name": "Unterflurhydrant: Unterflurhydrant Kreuzung Zum Spitzberg / RÃ¶thenweg",
    "popup_content": "<b>Unterflurhydrant</b><br>ğŸ“‹ Unterflurhydrant Kreuzung Zum Spitzberg / RÃ¶thenweg<br>ğŸ”§ Nenndurchmesser DN: 125.0 mm<br>ğŸš’ FF Hamberg<br>ğŸ“ 49.107520, 11.685420<br><a href='https://maps.apple.com/?daddr=49.10752,11.68542' target='_blank'>ğŸ Apple Karten</a><br><a href='https://maps.google.com/?daddr=49.10752,11.68542' target='_blank'>ğŸ“± Google Maps</a>"
  },
  {
    "id": 4,
    "lat": 49.10815,
    "lng": 11.68443,
    "type": "unterflurhydrant",
    "description": "Unterflurhydrant RÃ¶thenweg 13",
    "size": "80.0",
    "department": "FF Hamberg",
    "color": "#4444ff",
    "icon": "icons/blue-dot.png",
    "display_name": "Unterflurhydrant: Unterflurhydrant RÃ¶thenweg 13",
    "popup_content": "<b>Unterflurhydrant</b><br>ğŸ“‹ Unterflurhydrant RÃ¶thenweg 13<br>ğŸ”§ Nenndurchmesser DN: 80.0 mm<br>ğŸš’ FF Hamberg<br>ğŸ“ 49.108150, 11.684430<br><a href='https://maps.apple.com/?daddr=49.10815,11.68443' target='_blank'>ğŸ Apple Karten</a><br><a href='https://maps.google.com/?daddr=49.10815,11.68443' target='_blank'>ğŸ“± Google Maps</a>"
  },
  {
    "id": 5,
    "lat": 49.10693,
    "lng": 11.68444,
    "type": "unterflurhydrant",
    "description": "Unterflurhydrant Zum Spitzberg 10",
    "size": "100.0",
    "department": "FF Hamberg",
    "color": "#4444ff",
    "icon": "icons/blue-dot.png",
    "display_name": "Unterflurhydrant: Unterflurhydrant Zum Spitzberg 10",
    "popup_content": "<b>Unterflurhydrant</b><br>ğŸ“‹ Unterflurhydrant Zum Spitzberg 10<br>ğŸ”§ Nenndurchmesser DN: 100.0 mm<br>ğŸš’ FF Hamberg<br>ğŸ“ 49.106930, 11.684440<br><a href='https://maps.apple.com/?daddr=49.10693,11.68444' target='_blank'>ğŸ Apple Karten</a><br><a href='https://maps.google.com/?daddr=49.10693,11.68444' target='_blank'>ğŸ“± Google Maps</a>"
  },
  {
    "id": 6,
    "lat": 49.10738,
    "lng": 11.68313,
    "type": "unterflurhydrant",
    "description": "Unterflurhydrant Sonnenring 14",
    "size": "100.0",
    "department": "FF Hamberg",
    "color": "#4444ff",
    "icon": "icons/blue-dot.png",
    "display_name": "Unterflurhydrant: Unterflurhydrant Sonnenring 14",
    "popup_content": "<b>Unterflurhydrant</b><br>ğŸ“‹ Unterflurhydrant Sonnenring 14<br>ğŸ”§ Nenndurchmesser DN: 100.0 mm<br>ğŸš’ FF Hamberg<br>ğŸ“ 49.107380, 11.683130<br><a href='https://maps.apple.com/?daddr=49.10738,11.68313' target='_blank'>ğŸ Apple Karten</a><br><a href='https://maps.google.com/?daddr=49.10738,11.68313' target='_blank'>ğŸ“± Google Maps</a>"
  },
  {
    "id": 7,
    "lat": 49.10664,
    "lng": 11.68528,
    "type": "unterflurhydrant",
    "description": "Unterflurhydrant Kiefergasse 5",
    "size": "80.0",
    "department": "FF Hamberg",
    "color": "#4444ff",
    "icon": "icons/blue-dot.png",
    "display_name": "Unterflurhydrant: Unterflurhydrant Kiefergasse 5",
    "popup_content": "<b>Unterflurhydrant</b><br>ğŸ“‹ Unterflurhydrant Kiefergasse 5<br>ğŸ”§ Nenndurchmesser DN: 80.0 mm<br>ğŸš’ FF Hamberg<br>ğŸ“ 49.106640, 11.685280<br><a href='https://maps.apple.com/?daddr=49.10664,11.68528' target='_blank'>ğŸ Apple Karten</a><br><a href='https://maps.google.com/?daddr=49.10664,11.68528' target='_blank'>ğŸ“± Google Maps</a>"
  },
  {
    "id": 8,
    "lat": 49.10597,
    "lng": 11.68546,
    "type": "unterflurhydrant",
    "description": "Unterflurhydrant Rascher Str. 13",
    "size": "80.0",
    "department": "FF Hamberg",
    "color": "#4444ff",
    "icon": "icons/blue-dot.png",
    "display_name": "Unterflurhydrant: Unterflurhydrant Rascher Str. 13",
    "popup_content": "<b>Unterflurhydrant</b><br>ğŸ“‹ Unterflurhydrant Rascher Str. 13<br>ğŸ”§ Nenndurchmesser DN: 80.0 mm<br>ğŸš’ FF Hamberg<br>ğŸ“ 49.105970, 11.685460<br><a href='https://maps.apple.com/?daddr=49.10597,11.68546' target='_blank'>ğŸ Apple Karten</a><br><a href='https://maps.google.com/?daddr=49.10597,11.68546' target='_blank'>ğŸ“± Google Maps</a>"
  },
  {
    "id": 9,
    "lat": 49.1055,
    "lng": 11.68611,
    "type": "unterflurhydrant",
    "description": "Unterflurhydrant Rascher Str. 9",
    "size": "80.0",
    "department": "FF Hamberg",
    "color": "#4444ff",
    "icon": "icons/blue-dot.png",
    "display_name": "Unterflurhydrant: Unterflurhydrant Rascher Str. 9",
    "popup_content": "<b>Unterflurhydrant</b><br>ğŸ“‹ Unterflurhydrant Rascher Str. 9<br>ğŸ”§ Nenndurchmesser DN: 80.0 mm<br>ğŸš’ FF Hamberg<br>ğŸ“ 49.105500, 11.686110<br><a href='https://maps.apple.com/?daddr=49.1055,11.68611' target='_blank'>ğŸ Apple Karten</a><br><a href='https://maps.google.com/?daddr=49.1055,11.68611' target='_blank'>ğŸ“± Google Maps</a>"
  },
  {
    "id": 10,
    "lat": 49.10605,
    "lng": 11.6862,
    "type": "unterflurhydrant",
    "description": "Unterflurhydrant RÃ¶thenweg 6",
    "size": "100.0",
    "department": "FF Hamberg",
    "color": "#4444ff",
    "icon": "icons/blue-dot.png",
    "display_name": "Unterflurhydrant: Unterflurhydrant RÃ¶thenweg 6",
    "popup_content": "<b>Unterflurhydrant</b><br>ğŸ“‹ Unterflurhydrant RÃ¶thenweg 6<br>ğŸ”§ Nenndurchmesser DN: 100.0 mm<br>ğŸš’ FF Hamberg<br>ğŸ“ 49.106050, 11.686200<br><a href='https://maps.apple.com/?daddr=49.10605,11.6862' target='_blank'>ğŸ Apple Karten</a><br><a href='https://maps.google.com/?daddr=49.10605,11.6862' target='_blank'>ğŸ“± Google Maps</a>"
  },
  {
    "id": 11,
    "lat": 49.10668,
    "lng": 11.68604,
    "type": "unterflurhydrant",
    "description": "Unterflurhydrant RÃ¶thenweg",
    "size": "80.0",
    "department": "FF Hamberg",
    "color": "#4444ff",
    "icon": "icons/blue-dot.png",
    "display_name": "Unterflurhydrant: Unterflurhydrant RÃ¶thenweg",
    "popup_content": "<b>Unterflurhydrant</b><br>ğŸ“‹ Unterflurhydrant RÃ¶thenweg<br>ğŸ”§ Nenndurchmesser DN: 80.0 mm<br>ğŸš’ FF Hamberg<br>ğŸ“ 49.106680, 11.686040<br><a href='https://maps.apple.com/?daddr=49.10668,11.68604' target='_blank'>ğŸ Apple Karten</a><br><a href='https://maps.google.com/?daddr=49.10668,11.68604' target='_blank'>ğŸ“± Google Maps</a>"
  },
  {
    "id": 12,
    "lat": 49.10786,
    "lng": 11.68775,
    "type": "unterflurhydrant",
    "description": "Unterflurhydrant HauptstraÃŸe 17",
    "size": "125.0",
    "department": "FF Hamberg",
    "color": "#4444ff",
    "icon": "icons/blue-dot.png",
    "display_name": "Unterflurhydrant: Unterflurhydrant HauptstraÃŸe 17",
    "popup_content": "<b>Unterflurhydrant</b><br>ğŸ“‹ Unterflurhydrant HauptstraÃŸe 17<br>ğŸ”§ Nenndurchmesser DN: 125.0 mm<br>ğŸš’ FF Hamberg<br>ğŸ“ 49.107860, 11.687750<br><a href='https://maps.apple.com/?daddr=49.10786,11.68775' target='_blank'>ğŸ Apple Karten</a><br><a href='https://maps.google.com/?daddr=49.10786,11.68775' target='_blank'>ğŸ“± Google Maps</a>"
  },
  {
    "id": 13,
    "lat": 49.1068,
    "lng": 11.68672,
    "type": "Ã¼berflurhydrant",
    "description": "Ãœberflurhydrant HauptstraÃŸe 28",
    "size": "80.0",
    "department": "FF Hamberg",
    "color": "#ff4444",
    "icon": "icons/red-dot.png",
    "display_name": "Ãœberflurhydrant: Ãœberflurhydrant HauptstraÃŸe 28",
    "popup_content": "<b>Ãœberflurhydrant</b><br>ğŸ“‹ Ãœberflurhydrant HauptstraÃŸe 28<br>ğŸ”§ Nenndurchmesser DN: 80.0 mm<br>ğŸš’ FF Hamberg<br>ğŸ“ 49.106800, 11.686720<br><a href='https://maps.apple.com/?daddr=49.1068,11.68672' target='_blank'>ğŸ Apple Karten</a><br><a href='https://maps.google.com/?daddr=49.1068,11.68672' target='_blank'>ğŸ“± Google Maps</a>"
  },
  {
    "id": 14,
    "lat": 49.1063,
    "lng": 11.68724,
    "type": "unterflurhydrant",
    "description": "Unterflurhydrant HauptstraÃŸe 21b",
    "size": "125.0",
    "department": "FF Hamberg",
    "color": "#4444ff",
    "icon": "icons/blue-dot.png",
    "display_name": "Unterflurhydrant: Unterflurhydrant HauptstraÃŸe 21b",
    "popup_content": "<b>Unterflurhydrant</b><br>ğŸ“‹ Unterflurhydrant HauptstraÃŸe 21b<br>ğŸ”§ Nenndurchmesser DN: 125.0 mm<br>ğŸš’ FF Hamberg<br>ğŸ“ 49.106300, 11.687240<br><a href='https://maps.apple.com/?daddr=49.1063,11.68724' target='_blank'>ğŸ Apple Karten</a><br><a href='https://maps.google.com/?daddr=49.1063,11.68724' target='_blank'>ğŸ“± Google Maps</a>"
  },
  {
    "id": 15,
    "lat": 49.10557,
    "lng": 11.68756,
    "type": "unterflurhydrant",
    "description": "Unterflurhydrant HauptstraÃŸe 25",
    "size": "125.0",
    "department": "FF Hamberg",
    "color": "#4444ff",
    "icon": "icons/blue-dot.png",
    "display_name": "Unterflurhydrant: Unterflurhydrant HauptstraÃŸe 25",
    "popup_content": "<b>Unterflurhydrant</b><br>ğŸ“‹ Unterflurhydrant HauptstraÃŸe 25<br>ğŸ”§ Nenndurchmesser DN: 125.0 mm<br>ğŸš’ FF Hamberg<br>ğŸ“ 49.105570, 11.687560<br><a href='https://maps.apple.com/?daddr=49.10557,11.68756' target='_blank'>ğŸ Apple Karten</a><br><a href='https://maps.google.com/?daddr=49.10557,11.68756' target='_blank'>ğŸ“± Google Maps</a>"
  },
  {
    "id": 16,
    "lat": 49.10483,
    "lng": 11.68749,
    "type": "Ã¼berflurhydrant",
    "description": "Ãœberflurhydrant HauptstraÃŸe 29",
    "size": "80.0",
    "department": "FF Hamberg",
    "color": "#ff4444",
    "icon": "icons/red-dot.png",
    "display_name": "Ãœberflurhydrant: Ãœberflurhydrant HauptstraÃŸe 29",
    "popup_content": "<b>Ãœberflurhydrant</b><br>ğŸ“‹ Ãœberflurhydrant HauptstraÃŸe 29<br>ğŸ”§ Nenndurchmesser DN: 80.0 mm<br>ğŸš’ FF Hamberg<br>ğŸ“ 49.104830, 11.687490<br><a href='https://maps.apple.com/?daddr=49.10483,11.68749' target='_blank'>ğŸ Apple Karten</a><br><a href='https://maps.google.com/?daddr=49.10483,11.68749' target='_blank'>ğŸ“± Google Maps</a>"
  },
  {
    "id": 17,
    "lat": 49.10502,
    "lng": 11.68894,
    "type": "unterflurhydrant",
    "description": "Unterflurhydrant Herrnrieder Str. 2",
    "size": "100.0",
    "department": "FF Hamberg",
    "color": "#4444ff",
    "icon": "icons/blue-dot.png",
    "display_name": "Unterflurhydrant: Unterflurhydrant Herrnrieder Str. 2",
    "popup_content": "<b>Unterflurhydrant</b><br>ğŸ“‹ Unterflurhydrant Herrnrieder Str. 2<br>ğŸ”§ Nenndurchmesser DN: 100.0 mm<br>ğŸš’ FF Hamberg<br>ğŸ“ 49.105020, 11.688940<br><a href='https://maps.apple.com/?daddr=49.10502,11.68894' target='_blank'>ğŸ Apple Karten</a><br><a href='https://maps.google.com/?daddr=49.10502,11.68894' target='_blank'>ğŸ“± Google Maps</a>"
  },
  {
    "id": 18,
    "lat": 49.10279,
    "lng": 11.68877,
    "type": "Ã¼berflurhydrant",
    "description": "Ãœberflurhydrant Eichlberger Str. 12",
    "size": "80.0",
    "department": "FF Hamberg",
    "color": "#ff4444",
    "icon": "icons/red-dot.png",
    "display_name": "Ãœberflurhydrant: Ãœberflurhydrant Eichlberger Str. 12",
    "popup_content": "<b>Ãœberflurhydrant</b><br>ğŸ“‹ Ãœberflurhydrant Eichlberger Str. 12<br>ğŸ”§ Nenndurchmesser DN: 80.0 mm<br>ğŸš’ FF Hamberg<br>ğŸ“ 49.102790, 11.688770<br><a href='https://maps.apple.com/?daddr=49.10279,11.68877' target='_blank'>ğŸ Apple Karten</a><br><a href='https://maps.google.com/?daddr=49.10279,11.68877' target='_blank'>ğŸ“± Google Maps</a>"
  },
  {
    "id": 19,
    "lat": 49.10373,
    "lng": 11.6877,
    "type": "Ã¼berflurhydrant",
    "description": "Ãœberflurhydrant Eichlberger Str. 3",
    "size": "80.0",
    "department": "FF Hamberg",
    "color": "#ff4444",
    "icon": "icons/red-dot.png",
    "display_name": "Ãœberflurhydrant: Ãœberflurhydrant Eichlberger Str. 3",
    "popup_content": "<b>Ãœberflurhydrant</b><br>ğŸ“‹ Ãœberflurhydrant Eichlberger Str. 3<br>ğŸ”§ Nenndurchmesser DN: 80.0 mm<br>ğŸš’ FF Hamberg<br>ğŸ“ 49.103730, 11.687700<br><a href='https://maps.apple.com/?daddr=49.10373,11.6877' target='_blank'>ğŸ Apple Karten</a><br><a href='https://maps.google.com/?daddr=49.10373,11.6877' target='_blank'>ğŸ“± Google Maps</a>"
  },
  {
    "id": 20,
    "lat": 49.1043,
    "lng": 11.68642,
    "type": "unterflurhydrant",
    "description": "Unterflurhydrant HauptstraÃŸe 35",
    "size": "100.0",
    "department": "FF Hamberg",
    "color": "#4444ff",
    "icon": "icons/blue-dot.png",
    "display_name": "Unterflurhydrant: Unterflurhydrant HauptstraÃŸe 35",
    "popup_content": "<b>Unterflurhydrant</b><br>ğŸ“‹ Unterflurhydrant HauptstraÃŸe 35<br>ğŸ”§ Nenndurchmesser DN: 100.0 mm<br>ğŸš’ FF Hamberg<br>ğŸ“ 49.104300, 11.686420<br><a href='https://maps.apple.com/?daddr=49.1043,11.68642' target='_blank'>ğŸ Apple Karten</a><br><a href='https://maps.google.com/?daddr=49.1043,11.68642' target='_blank'>ğŸ“± Google Maps</a>"
  },
  {
    "id": 21,
    "lat": 49.10412,
    "lng": 11.68603,
    "type": "unterflurhydrant",
    "description": "Unterflurhydrant HauptstraÃŸe 37",
    "size": "80.0",
    "department": "FF Hamberg",
    "color": "#4444ff",
    "icon": "icons/blue-dot.png",
    "display_name": "Unterflurhydrant: Unterflurhydrant HauptstraÃŸe 37",
    "popup_content": "<b>Unterflurhydrant</b><br>ğŸ“‹ Unterflurhydrant HauptstraÃŸe 37<br>ğŸ”§ Nenndurchmesser DN: 80.0 mm<br>ğŸš’ FF Hamberg<br>ğŸ“ 49.104120, 11.686030<br><a href='https://maps.apple.com/?daddr=49.10412,11.68603' target='_blank'>ğŸ Apple Karten</a><br><a href='https://maps.google.com/?daddr=49.10412,11.68603' target='_blank'>ğŸ“± Google Maps</a>"
  },
  {
    "id": 22,
    "lat": 49.10355,
    "lng": 11.68542,
    "type": "unterflurhydrant",
    "description": "Unterflurhydrant HauptstraÃŸe 41",
    "size": "80.0",
    "department": "FF Hamberg",
    "color": "#4444ff",
    "icon": "icons/blue-dot.png",
    "display_name": "Unterflurhydrant: Unterflurhydrant HauptstraÃŸe 41",
    "popup_content": "<b>Unterflurhydrant</b><br>ğŸ“‹ Unterflurhydrant HauptstraÃŸe 41<br>ğŸ”§ Nenndurchmesser DN: 80.0 mm<br>ğŸš’ FF Hamberg<br>ğŸ“ 49.103550, 11.685420<br><a href='https://maps.apple.com/?daddr=49.10355,11.68542' target='_blank'>ğŸ Apple Karten</a><br><a href='https://maps.google.com/?daddr=49.10355,11.68542' target='_blank'>ğŸ“± Google Maps</a>"
  },
  {
    "id": 23,
    "lat": 49.10372,
    "lng": 11.68505,
    "type": "unterflurhydrant",
    "description": "Unterflurhydrant HauptstraÃŸe 46",
    "size": "80.0",
    "department": "FF Hamberg",
    "color": "#4444ff",
    "icon": "icons/blue-dot.png",
    "display_name": "Unterflurhydrant: Unterflurhydrant HauptstraÃŸe 46",
    "popup_content": "<b>Unterflurhydrant</b><br>ğŸ“‹ Unterflurhydrant HauptstraÃŸe 46<br>ğŸ”§ Nenndurchmesser DN: 80.0 mm<br>ğŸš’ FF Hamberg<br>ğŸ“ 49.103720, 11.685050<br><a href='https://maps.apple.com/?daddr=49.10372,11.68505' target='_blank'>ğŸ Apple Karten</a><br><a href='https://maps.google.com/?daddr=49.10372,11.68505' target='_blank'>ğŸ“± Google Maps</a>"
  },
  {
    "id": 24,
    "lat": 49.10288,
    "lng": 11.68749,
    "type": "unterflurhydrant",
    "description": "Unterflurhydrant Eichlberger Str. 12",
    "size": "125.0",
    "department": "FF Hamberg",
    "color": "#4444ff",
    "icon": "icons/blue-dot.png",
    "display_name": "Unterflurhydrant: Unterflurhydrant Eichlberger Str. 12",
    "popup_content": "<b>Unterflurhydrant</b><br>ğŸ“‹ Unterflurhydrant Eichlberger Str. 12<br>ğŸ”§ Nenndurchmesser DN: 125.0 mm<br>ğŸš’ FF Hamberg<br>ğŸ“ 49.102880, 11.687490<br><a href='https://maps.apple.com/?daddr=49.10288,11.68749' target='_blank'>ğŸ Apple Karten</a><br><a href='https://maps.google.com/?daddr=49.10288,11.68749' target='_blank'>ğŸ“± Google Maps</a>"
  },
  {
    "id": 25,
    "lat": 49.10367,
    "lng": 11.68839,
    "type": "unterflurhydrant",
    "description": "Unterflurhydrant Eichlberger Str. 4",
    "size": "100.0",
    "department": "FF Hamberg",
    "color": "#4444ff",
    "icon": "icons/blue-dot.png",
    "display_name": "Unterflurhydrant: Unterflurhydrant Eichlberger Str. 4",
    "popup_content": "<b>Unterflurhydrant</b><br>ğŸ“‹ Unterflurhydrant Eichlberger Str. 4<br>ğŸ”§ Nenndurchmesser DN: 100.0 mm<br>ğŸš’ FF Hamberg<br>ğŸ“ 49.103670, 11.688390<br><a href='https://maps.apple.com/?daddr=49.10367,11.68839' target='_blank'>ğŸ Apple Karten</a><br><a href='https://maps.google.com/?daddr=49.10367,11.68839' target='_blank'>ğŸ“± Google Maps</a>"
  },
  {
    "id": 26,
    "lat": 49.11046,
    "lng": 11.67008,
    "type": "Ã¼berflurhydrant",
    "description": "Ãœberflurhydrant Ã–dberg 1",
    "size": "80.0",
    "department": "FF Hamberg",
    "color": "#ff4444",
    "icon": "icons/red-dot.png",
    "display_name": "Ãœberflurhydrant: Ãœberflurhydrant Ã–dberg 1",
    "popup_content": "<b>Ãœberflurhydrant</b><br>ğŸ“‹ Ãœberflurhydrant Ã–dberg 1<br>ğŸ”§ Nenndurchmesser DN: 80.0 mm<br>ğŸš’ FF Hamberg<br>ğŸ“ 49.110460, 11.670080<br><a href='https://maps.apple.com/?daddr=49.11046,11.67008' target='_blank'>ğŸ Apple Karten</a><br><a href='https://maps.google.com/?daddr=49.11046,11.67008' target='_blank'>ğŸ“± Google Maps</a>"
  },
  {
    "id": 27,
    "lat": 49.11063,
    "lng": 11.67348,
    "type": "unterflurhydrant",
    "description": "Unterflurhydrant Ã–dberg 3",
    "size": "80.0",
    "department": "FF Hamberg",
    "color": "#4444ff",
    "icon": "icons/blue-dot.png",
    "display_name": "Unterflurhydrant: Unterflurhydrant Ã–dberg 3",
    "popup_content": "<b>Unterflurhydrant</b><br>ğŸ“‹ Unterflurhydrant Ã–dberg 3<br>ğŸ”§ Nenndurchmesser DN: 80.0 mm<br>ğŸš’ FF Hamberg<br>ğŸ“ 49.110630, 11.673480<br><a href='https://maps.apple.com/?daddr=49.11063,11.67348' target='_blank'>ğŸ Apple Karten</a><br><a href='https://maps.google.com/?daddr=49.11063,11.67348' target='_blank'>ğŸ“± Google Maps</a>"
  },
  {
    "id": 28,
    "lat": 49.1111,
    "lng": 11.67341,
    "type": "Ã¼berflurhydrant",
    "description": "Ãœberflurhydrant Ã–dberg 4",
    "size": "80.0",
    "department": "FF Hamberg",
    "color": "#ff4444",
    "icon": "icons/red-dot.png",
    "display_name": "Ãœberflurhydrant: Ãœberflurhydrant Ã–dberg 4",
    "popup_content": "<b>Ãœberflurhydrant</b><br>ğŸ“‹ Ãœberflurhydrant Ã–dberg 4<br>ğŸ”§ Nenndurchmesser DN: 80.0 mm<br>ğŸš’ FF Hamberg<br>ğŸ“ 49.111100, 11.673410<br><a href='https://maps.apple.com/?daddr=49.1111,11.67341' target='_blank'>ğŸ Apple Karten</a><br><a href='https://maps.google.com/?daddr=49.1111,11.67341' target='_blank'>ğŸ“± Google Maps</a>"
  },
  {
    "id": 29,
    "lat": 49.11035,
    "lng": 11.6837,
    "type": "unterflurhydrant",
    "description": "Unterflurhydrant Sportplatz",
    "size": "80.0",
    "department": "FF Hamberg",
    "color": "#4444ff",
    "icon": "icons/blue-dot.png",
    "display_name": "Unterflurhydrant: Unterflurhydrant Sportplatz",
    "popup_content": "<b>Unterflurhydrant</b><br>ğŸ“‹ Unterflurhydrant Sportplatz<br>ğŸ”§ Nenndurchmesser DN: 80.0 mm<br>ğŸš’ FF Hamberg<br>ğŸ“ 49.110350, 11.683700<br><a href='https://maps.apple.com/?daddr=49.11035,11.6837' target='_blank'>ğŸ Apple Karten</a><br><a href='https://maps.google.com/?daddr=49.11035,11.6837' target='_blank'>ğŸ“± Google Maps</a>"
  },
  {
    "id": 30,
    "lat": 49.11208,
    "lng": 11.68469,
    "type": "unterflurhydrant",
    "description": "Unterflurhydrant Kreuzung ReitstraÃŸe/Spanbergweg",
    "size": "80.0",
    "department": "FF Hamberg",
    "color": "#4444ff",
    "icon": "icons/blue-dot.png",
    "display_name": "Unterflurhydrant: Unterflurhydrant Kreuzung ReitstraÃŸe/Spanbergweg",
    "popup_content": "<b>Unterflurhydrant</b><br>ğŸ“‹ Unterflurhydrant Kreuzung ReitstraÃŸe/Spanbergweg<br>ğŸ”§ Nenndurchmesser DN: 80.0 mm<br>ğŸš’ FF Hamberg<br>ğŸ“ 49.112080, 11.684690<br><a href='https://maps.apple.com/?daddr=49.11208,11.68469' target='_blank'>ğŸ Apple Karten</a><br><a href='https://maps.google.com/?daddr=49.11208,11.68469' target='_blank'>ğŸ“± Google Maps</a>"
  },
  {
    "id": 31,
    "lat": 49.11304,
    "lng": 11.68592,
    "type": "Ã¼berflurhydrant",
    "description": "Ãœberflurhydrant Gabelung ReitstraÃŸe/Winner Str.",
    "size": "80.0",
    "department": "FF Hamberg",
    "color": "#ff4444",
    "icon": "icons/red-dot.png",
    "display_name": "Ãœberflurhydrant: Ãœberflurhydrant Gabelung ReitstraÃŸe/Winner Str.",
    "popup_content": "<b>Ãœberflurhydrant</b><br>ğŸ“‹ Ãœberflurhydrant Gabelung ReitstraÃŸe/Winner Str.<br>ğŸ”§ Nenndurchmesser DN: 80.0 mm<br>ğŸš’ FF Hamberg<br>ğŸ“ 49.113040, 11.685920<br><a href='https://maps.apple.com/?daddr=49.11304,11.68592' target='_blank'>ğŸ Apple Karten</a><br><a href='https://maps.google.com/?daddr=49.11304,11.68592' target='_blank'>ğŸ“± Google Maps</a>"
  },
  {
    "id": 32,
    "lat": 49.11292,
    "lng": 11.68668,
    "type": "Ã¼berflurhydrant",
    "description": "Ãœberflurhydrant BushÃ¤uschen SchnÃ¶dorf",
    "size": "80.0",
    "department": "FF Hamberg",
    "color": "#ff4444",
    "icon": "icons/red-dot.png",
    "display_name": "Ãœberflurhydrant: Ãœberflurhydrant BushÃ¤uschen SchnÃ¶dorf",
    "popup_content": "<b>Ãœberflurhydrant</b><br>ğŸ“‹ Ãœberflurhydrant BushÃ¤uschen SchnÃ¶dorf<br>ğŸ”§ Nenndurchmesser DN: 80.0 mm<br>ğŸš’ FF Hamberg<br>ğŸ“ 49.112920, 11.686680<br><a href='https://maps.apple.com/?daddr=49.11292,11.68668' target='_blank'>ğŸ Apple Karten</a><br><a href='https://maps.google.com/?daddr=49.11292,11.68668' target='_blank'>ğŸ“± Google Maps</a>"
  },
  {
    "id": 33,
    "lat": 49.11328,
    "lng": 11.68606,
    "type": "unterflurhydrant",
    "description": "Unterflurhydrant Winner Str. 1",
    "size": "80.0",
    "department": "FF Hamberg",
    "color": "#4444ff",
    "icon": "icons/blue-dot.png",
    "display_name": "Unterflurhydrant: Unterflurhydrant Winner Str. 1",
    "popup_content": "<b>Unterflurhydrant</b><br>ğŸ“‹ Unterflurhydrant Winner Str. 1<br>ğŸ”§ Nenndurchmesser DN: 80.0 mm<br>ğŸš’ FF Hamberg<br>ğŸ“ 49.113280, 11.686060<br><a href='https://maps.apple.com/?daddr=49.11328,11.68606' target='_blank'>ğŸ Apple Karten</a><br><a href='https://maps.google.com/?daddr=49.11328,11.68606' target='_blank'>ğŸ“± Google Maps</a>"
  },
  {
    "id": 34,
    "lat": 49.11447,
    "lng": 11.6874,
    "type": "unterflurhydrant",
    "description": "Unterflurhydrant Winner Str. 6",
    "size": "80.0",
    "department": "FF Hamberg",
    "color": "#4444ff",
    "icon": "icons/blue-dot.png",
    "display_name": "Unterflurhydrant: Unterflurhydrant Winner Str. 6",
    "popup_content": "<b>Unterflurhydrant</b><br>ğŸ“‹ Unterflurhydrant Winner Str. 6<br>ğŸ”§ Nenndurchmesser DN: 80.0 mm<br>ğŸš’ FF Hamberg<br>ğŸ“ 49.114470, 11.687400<br><a href='https://maps.apple.com/?daddr=49.11447,11.6874' target='_blank'>ğŸ Apple Karten</a><br><a href='https://maps.google.com/?daddr=49.11447,11.6874' target='_blank'>ğŸ“± Google Maps</a>"
  },
  {
    "id": 35,
    "lat": 49.11339,
    "lng": 11.68766,
    "type": "Ã¼berflurhydrant",
    "description": "Ãœberflurhydrant ReitstraÃŸe 20",
    "size": "80.0",
    "department": "FF Hamberg",
    "color": "#ff4444",
    "icon": "icons/red-dot.png",
    "display_name": "Ãœberflurhydrant: Ãœberflurhydrant ReitstraÃŸe 20",
    "popup_content": "<b>Ãœberflurhydrant</b><br>ğŸ“‹ Ãœberflurhydrant ReitstraÃŸe 20<br>ğŸ”§ Nenndurchmesser DN: 80.0 mm<br>ğŸš’ FF Hamberg<br>ğŸ“ 49.113390, 11.687660<br><a href='https://maps.apple.com/?daddr=49.11339,11.68766' target='_blank'>ğŸ Apple Karten</a><br><a href='https://maps.google.com/?daddr=49.11339,11.68766' target='_blank'>ğŸ“± Google Maps</a>"
  },
  {
    "id": 36,
    "lat": 49.11098,
    "lng": 11.68577,
    "type": "unterflurhydrant",
    "description": "Unterflurhydrant Hohe Trift 5",
    "size": "80.0",
    "department": "FF Hamberg",
    "color": "#4444ff",
    "icon": "icons/blue-dot.png",
    "display_name": "Unterflurhydrant: Unterflurhydrant Hohe Trift 5",
    "popup_content": "<b>Unterflurhydrant</b><br>ğŸ“‹ Unterflurhydrant Hohe Trift 5<br>ğŸ”§ Nenndurchmesser DN: 80.0 mm<br>ğŸš’ FF Hamberg<br>ğŸ“ 49.110980, 11.685770<br><a href='https://maps.apple.com/?daddr=49.11098,11.68577' target='_blank'>ğŸ Apple Karten</a><br><a href='https://maps.google.com/?daddr=49.11098,11.68577' target='_blank'>ğŸ“± Google Maps</a>"
  },
  {
    "id": 37,
    "lat": 49.11124,
    "lng": 11.68644,
    "type": "unterflurhydrant",
    "description": "Unterflurhydrant Hohe Trift 2, EinmÃ¼ndung Spanbergweg",
    "size": "150.0",
    "department": "FF Hamberg",
    "color": "#4444ff",
    "icon": "icons/blue-dot.png",
    "display_name": "Unterflurhydrant: Unterflurhydrant Hohe Trift 2, EinmÃ¼ndung Spanbergweg",
    "popup_content": "<b>Unterflurhydrant</b><br>ğŸ“‹ Unterflurhydrant Hohe Trift 2, EinmÃ¼ndung Spanbergweg<br>ğŸ”§ Nenndurchmesser DN: 150.0 mm<br>ğŸš’ FF Hamberg<br>ğŸ“ 49.111240, 11.686440<br><a href='https://maps.apple.com/?daddr=49.11124,11.68644' target='_blank'>ğŸ Apple Karten</a><br><a href='https://maps.google.com/?daddr=49.11124,11.68644' target='_blank'>ğŸ“± Google Maps</a>"
  },
  {
    "id": 38,
    "lat": 49.11065,
    "lng": 11.68653,
    "type": "unterflurhydrant",
    "description": "Unterflurhydrant HauptstraÃŸe 1",
    "size": "150.0",
    "department": "FF Hamberg",
    "color": "#4444ff",
    "icon": "icons/blue-dot.png",
    "display_name": "Unterflurhydrant: Unterflurhydrant HauptstraÃŸe 1",
    "popup_content": "<b>Unterflurhydrant</b><br>ğŸ“‹ Unterflurhydrant HauptstraÃŸe 1<br>ğŸ”§ Nenndurchmesser DN: 150.0 mm<br>ğŸš’ FF Hamberg<br>ğŸ“ 49.110650, 11.686530<br><a href='https://maps.apple.com/?daddr=49.11065,11.68653' target='_blank'>ğŸ Apple Karten</a><br><a href='https://maps.google.com/?daddr=49.11065,11.68653' target='_blank'>ğŸ“± Google Maps</a>"
  },
  {
    "id": 39,
    "lat": 49.11,
    "lng": 11.68699,
    "type": "unterflurhydrant",
    "description": "Unterflurhydrant HauptstraÃŸe 3",
    "size": "100.0",
    "department": "FF Hamberg",
    "color": "#4444ff",
    "icon": "icons/blue-dot.png",
    "display_name": "Unterflurhydrant: Unterflurhydrant HauptstraÃŸe 3",
    "popup_content": "<b>Unterflurhydrant</b><br>ğŸ“‹ Unterflurhydrant HauptstraÃŸe 3<br>ğŸ”§ Nenndurchmesser DN: 100.0 mm<br>ğŸš’ FF Hamberg<br>ğŸ“ 49.110000, 11.686990<br><a href='https://maps.apple.com/?daddr=49.11,11.68699' target='_blank'>ğŸ Apple Karten</a><br><a href='https://maps.google.com/?daddr=49.11,11.68699' target='_blank'>ğŸ“± Google Maps</a>"
  },
  {
    "id": 40,
    "lat": 49.1091,
    "lng": 11.68704,
    "type": "Ã¼berflurhydrant",
    "description": "Ãœberflurhydrant HauptstraÃŸe 10",
    "size": "80.0",
    "department": "FF Hamberg",
    "color": "#ff4444",
    "icon": "icons/red-dot.png",
    "display_name": "Ãœberflurhydrant: Ãœberflurhydrant HauptstraÃŸe 10",
    "popup_content": "<b>Ãœberflurhydrant</b><br>ğŸ“‹ Ãœberflurhydrant HauptstraÃŸe 10<br>ğŸ”§ Nenndurchmesser DN: 80.0 mm<br>ğŸš’ FF Hamberg<br>ğŸ“ 49.109100, 11.687040<br><a href='https://maps.apple.com/?daddr=49.1091,11.68704' target='_blank'>ğŸ Apple Karten</a><br><a href='https://maps.google.com/?daddr=49.1091,11.68704' target='_blank'>ğŸ“± Google Maps</a>"
  },
  {
    "id": 41,
    "lat": 49.10941,
    "lng": 11.68767,
    "type": "wasserbehÃ¤lter",
    "description": "LÃ¶schwasserbehÃ¤lter Talweg, EinmÃ¼ndung Pfarrgasse",
    "size": "",
    "department": "FF Hamberg",
    "color": "#ffff44",
    "icon": "icons/yellow-dot.png",
    "display_name": "WasserbehÃ¤lter: LÃ¶schwasserbehÃ¤lter Talweg, EinmÃ¼ndung Pfarrgasse",
    "popup_content": "<b>WasserbehÃ¤lter</b><br>ğŸ“‹ LÃ¶schwasserbehÃ¤lter Talweg, EinmÃ¼ndung Pfarrgasse<br>ğŸš’ FF Hamberg<br>ğŸ“ 49.109410, 11.687670<br><a href='https://maps.apple.com/?daddr=49.10941,11.68767' target='_blank'>ğŸ Apple Karten</a><br><a href='https://maps.google.com/?daddr=49.10941,11.68767' target='_blank'>ğŸ“± Google Maps</a>"
  },
  {
    "id": 42,
    "lat": 49.10881,
    "lng": 11.68816,
    "type": "unterflurhydrant",
    "description": "Unterflurhydrant Pfarrgasse 4",
    "size": "100.0",
    "department": "FF Hamberg",
    "color": "#4444ff",
    "icon": "icons/blue-dot.png",
    "display_name": "Unterflurhydrant: Unterflurhydrant Pfarrgasse 4",
    "popup_content": "<b>Unterflurhydrant</b><br>ğŸ“‹ Unterflurhydrant Pfarrgasse 4<br>ğŸ”§ Nenndurchmesser DN: 100.0 mm<br>ğŸš’ FF Hamberg<br>ğŸ“ 49.108810, 11.688160<br><a href='https://maps.apple.com/?daddr=49.10881,11.68816' target='_blank'>ğŸ Apple Karten</a><br><a href='https://maps.google.com/?daddr=49.10881,11.68816' target='_blank'>ğŸ“± Google Maps</a>"
  },
  {
    "id": 43,
    "lat": 49.11375,
    "lng": 11.69697,
    "type": "Ã¼berflurhydrant",
    "description": "Ãœberflurhydrant Rofen",
    "size": "80.0",
    "department": "FF Hamberg",
    "color": "#ff4444",
    "icon": "icons/red-dot.png",
    "display_name": "Ãœberflurhydrant: Ãœberflurhydrant Rofen",
    "popup_content": "<b>Ãœberflurhydrant</b><br>ğŸ“‹ Ãœberflurhydrant Rofen<br>ğŸ”§ Nenndurchmesser DN: 80.0 mm<br>ğŸš’ FF Hamberg<br>ğŸ“ 49.113750, 11.696970<br><a href='https://maps.apple.com/?daddr=49.11375,11.69697' target='_blank'>ğŸ Apple Karten</a><br><a href='https://maps.google.com/?daddr=49.11375,11.69697' target='_blank'>ğŸ“± Google Maps</a>"
  },
  {
    "id": 44,
    "lat": 49.11399,
    "lng": 11.69562,
    "type": "unterflurhydrant",
    "description": "Unterflurhydrant Rofen",
    "size": "80.0",
    "department": "FF Hamberg",
    "color": "#4444ff",
    "icon": "icons/blue-dot.png",
    "display_name": "Unterflurhydrant: Unterflurhydrant Rofen",
    "popup_content": "<b>Unterflurhydrant</b><br>ğŸ“‹ Unterflurhydrant Rofen<br>ğŸ”§ Nenndurchmesser DN: 80.0 mm<br>ğŸš’ FF Hamberg<br>ğŸ“ 49.113990, 11.695620<br><a href='https://maps.apple.com/?daddr=49.11399,11.69562' target='_blank'>ğŸ Apple Karten</a><br><a href='https://maps.google.com/?daddr=49.11399,11.69562' target='_blank'>ğŸ“± Google Maps</a>"
  },
  {
    "id": 45,
    "lat": 49.10078,
    "lng": 11.68323,
    "type": "Ã¼berflurhydrant",
    "description": "Ãœberflurhydrant ZiegelhÃ¼tte 1",
    "size": "80.0",
    "department": "FF Hamberg",
    "color": "#ff4444",
    "icon": "icons/red-dot.png",
    "display_name": "Ãœberflurhydrant: Ãœberflurhydrant ZiegelhÃ¼tte 1",
    "popup_content": "<b>Ãœberflurhydrant</b><br>ğŸ“‹ Ãœberflurhydrant ZiegelhÃ¼tte 1<br>ğŸ”§ Nenndurchmesser DN: 80.0 mm<br>ğŸš’ FF Hamberg<br>ğŸ“ 49.100780, 11.683230<br><a href='https://maps.apple.com/?daddr=49.10078,11.68323' target='_blank'>ğŸ Apple Karten</a><br><a href='https://maps.google.com/?daddr=49.10078,11.68323' target='_blank'>ğŸ“± Google Maps</a>"
  },
  {
    "id": 46,
    "lat": 49.10849,
    "lng": 11.68725,
    "type": "unterflurhydrant",
    "description": "Unterflurhydrant Kirche",
    "size": "80.0",
    "department": "FF Hamberg",
    "color": "#4444ff",
    "icon": "icons/blue-dot.png",
    "display_name": "Unterflurhydrant: Unterflurhydrant Kirche",
    "popup_content": "<b>Unterflurhydrant</b><br>ğŸ“‹ Unterflurhydrant Kirche<br>ğŸ”§ Nenndurchmesser DN: 80.0 mm<br>ğŸš’ FF Hamberg<br>ğŸ“ 49.108490, 11.687250<br><a href='https://maps.apple.com/?daddr=49.10849,11.68725' target='_blank'>ğŸ Apple Karten</a><br><a href='https://maps.google.com/?daddr=49.10849,11.68725' target='_blank'>ğŸ“± Google Maps</a>"
  },
  {
    "id": 47,
    "lat": 49.092199,
    "lng": 11.70373,
    "type": "rettungspunkt",
    "description": "Rettungspunkt Schafsee Hamberg/Eichlberg",
    "size": "",
    "department": "FF Hamberg",
    "color": "#44ff44",
    "icon": "icons/green-dot.png",
    "display_name": "Rettungspunkt: Rettungspunkt Schafsee Hamberg/Eichlberg",
    "popup_content": "<b>Rettungspunkt</b><br>ğŸ“‹ Rettungspunkt Schafsee Hamberg/Eichlberg<br>ğŸš’ FF Hamberg<br>ğŸ“ 49.092199, 11.703730<br><a href='https://maps.apple.com/?daddr=49.092199,11.70373' target='_blank'>ğŸ Apple Karten</a><br><a href='https://maps.google.com/?daddr=49.092199,11.70373' target='_blank'>ğŸ“± Google Maps</a>"
  },
  {
    "id": 48,
    "lat": 49.086695,
    "lng": 11.66433953,
    "type": "rettungspunkt",
    "description": "Rettungspunkt NM-2131 Langenthonhausen",
    "size": "",
    "department": "FF Hamberg",
    "color": "#44ff44",
    "icon": "icons/green-dot.png",
    "display_name": "Rettungspunkt: Rettungspunkt NM-2131 Langenthonhausen",
    "popup_content": "<b>Rettungspunkt</b><br>ğŸ“‹ Rettungspunkt NM-2131 Langenthonhausen<br>ğŸš’ FF Hamberg<br>ğŸ“ 49.086695, 11.664340<br><a href='https://maps.apple.com/?daddr=49.086695,11.66433953' target='_blank'>ğŸ Apple Karten</a><br><a href='https://maps.google.com/?daddr=49.086695,11.66433953' target='_blank'>ğŸ“± Google Maps</a>"
  },
  {
    "id": 49,
    "lat": 49.10529568,
    "lng": 11.716126,
    "type": "rettungspunkt",
    "description": "Rettungspunkt Feuerwehrhaus Herrnried",
    "size": "",
    "department": "FF Hamberg",
    "color": "#44ff44",
    "icon": "icons/green-dot.png",
    "display_name": "Rettungspunkt: Rettungspunkt Feuerwehrhaus Herrnried",
    "popup_content": "<b>Rettungspunkt</b><br>ğŸ“‹ Rettungspunkt Feuerwehrhaus Herrnried<br>ğŸš’ FF Hamberg<br>ğŸ“ 49.105296, 11.716126<br><a href='https://maps.apple.com/?daddr=49.10529568,11.716126' target='_blank'>ğŸ Apple Karten</a><br><a href='https://maps.google.com/?daddr=49.10529568,11.716126' target='_blank'>ğŸ“± Google Maps</a>"
  },
  {
    "id": 50,
    "lat": 49.11173709,
    "lng": 11.66721575,
    "type": "rettungspunkt",
    "description": "Rettungspunkt NM-2171 Ã–dberg",
    "size": "",
    "department": "FF Hamberg",
    "color": "#44ff44",
    "icon": "icons/green-dot.png",
    "display_name": "Rettungspunkt: Rettungspunkt NM-2171 Ã–dberg",
    "popup_content": "<b>Rettungspunkt</b><br>ğŸ“‹ Rettungspunkt NM-2171 Ã–dberg<br>ğŸš’ FF Hamberg<br>ğŸ“ 49.111737, 11.667216<br><a href='https://maps.apple.com/?daddr=49.11173709,11.66721575' target='_blank'>ğŸ Apple Karten</a><br><a href='https://maps.google.com/?daddr=49.11173709,11.66721575' target='_blank'>ğŸ“± Google Maps</a>"
  },
  {
    "id": 51,
    "lat": 49.12040024,
    "lng": 11.71188973,
    "type": "rettungspunkt",
    "description": "Rettungspunkt NM-2189 B8 Parkplatz",
    "size": "",
    "department": "FF Hamberg",
    "color": "#44ff44",
    "icon": "icons/green-dot.png",
    "display_name": "Rettungspunkt: Rettungspunkt NM-2189 B8 Parkplatz",
    "popup_content": "<b>Rettungspunkt</b><br>ğŸ“‹ Rettungspunkt NM-2189 B8 Parkplatz<br>ğŸš’ FF Hamberg<br>ğŸ“ 49.120400, 11.711890<br><a href='https://maps.apple.com/?daddr=49.12040024,11.71188973' target='_blank'>ğŸ Apple Karten</a><br><a href='https://maps.google.com/?daddr=49.12040024,11.71188973' target='_blank'>ğŸ“± Google Maps</a>"
  }
];

// 2D Map Variables
let map, userMarker, cone, accuracyCircle, nearestHydrantLine;
let hydrantMarkers = [];
let windArrowLine = null;
let windArrowHead = null;
let currentThemeIndex = 0;

// AR Variables
let arVideo = null;
let arStream = null;
let arOverlaysVisible = true;

// Common Variables
let compassActive = false;
let flashlightMode = 0;
let flashlightStream = null;
let flashlightBlinkInterval = null;
let currentAltitude = null;
let currentAccuracy = null;
let isOffline = !navigator.onLine;
let watchId = null;
let isIOS = /iPad|iPhone|iPod/.test(navigator.userAgent);
let userHasControl = false;
let windArrowActive = true;
let lastWindUpdate = 0;

// AR Settings
const AR_MAX_DISTANCE = 500;
const AR_NEAR_THRESHOLD = 50;
const AR_FIELD_OF_VIEW = 90;

// Standard-Position
const DEFAULT_POSITION = { lat: 49.10951, lng: 11.68453 };


// ============================================================================
// INITIALIZATION
// ============================================================================
function initialize2DMap() {
  console.log('ğŸ—ºï¸ Initialisiere 2D-Karte...');
  
  // Tile Layers
  
  const theme0 = L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', { 
    attribution: 'Â© OpenStreetMap | 08.09.2025',
    maxZoom: 19
  });

  const theme1 = L.tileLayer('https://{s}.basemaps.cartocdn.com/dark_all/{z}/{x}/{y}.png', { 
    attribution: 'Â© CartoDB | 08.09.2025',
    maxZoom: 19
  });

  const theme2 = L.tileLayer('https://{s}.tile.opentopomap.org/{z}/{x}/{y}.png', { 
    attribution: 'Â© OpenTopoMap | 08.09.2025',
    maxZoom: 19
  });

  const theme3 = L.tileLayer('https://server.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}', { 
    attribution: 'Â© Esri | 08.09.2025',
    maxZoom: 19
  });

  // Initialize map
  map = L.map('map', { 
    center: [49.10951, 11.68453], 
    zoom: 15, 
    layers: [theme0],
    zoomControl: true,
    attributionControl: true
  });
  
  // Store themes for switching
  window.themes = [theme0, theme1, theme2, theme3];
  window.themeNames = ["Standard", "Dunkel", "Gel\u00e4nde", "Satellit"];
  
  // Add hydrant markers
  create2DHydrants();
  
  // Map event listeners
  map.on('dragstart', () => { userHasControl = true; });
  map.on('zoomstart', () => { userHasControl = true; });
  
  console.log('âœ… 2D-Karte initialisiert');
}

function create2DHydrants() {
  console.log('ğŸš° Erstelle 2D-Hydranten...');
  
  
  var marker = L.marker([49.10951, 11.68453], {
    icon: L.icon({
      iconUrl: 'icons/red-dot.png',
      iconSize: [32, 32],
      iconAnchor: [16, 32]
    })
  }).addTo(map).bindPopup(`<b>Ãœberflurhydrant</b><br>ğŸ“‹ Ãœberflurhydrant Feuerwehrhaus<br>ğŸ”§ Nenndurchmesser DN: 80.0 mm<br>ğŸš’ FF Hamberg<br>ğŸ“ 49.109510, 11.684530<br><a href='https://maps.apple.com/?daddr=49.10951,11.68453' target='_blank'>ğŸ Apple Karten</a><br><a href='https://maps.google.com/?daddr=49.10951,11.68453' target='_blank'>ğŸ“± Google Maps</a>`);
  marker.hydrantType = 'Ã¼berflurhydrant';
  hydrantMarkers.push(marker);
  var marker = L.marker([49.10895, 11.68544], {
    icon: L.icon({
      iconUrl: 'icons/blue-dot.png',
      iconSize: [32, 32],
      iconAnchor: [16, 32]
    })
  }).addTo(map).bindPopup(`<b>Unterflurhydrant</b><br>ğŸ“‹ Unterflurhydrant SchÃ¶ndorfer Str. 5<br>ğŸ”§ Nenndurchmesser DN: 80.0 mm<br>ğŸš’ FF Hamberg<br>ğŸ“ 49.108950, 11.685440<br><a href='https://maps.apple.com/?daddr=49.10895,11.68544' target='_blank'>ğŸ Apple Karten</a><br><a href='https://maps.google.com/?daddr=49.10895,11.68544' target='_blank'>ğŸ“± Google Maps</a>`);
  marker.hydrantType = 'unterflurhydrant';
  hydrantMarkers.push(marker);
  var marker = L.marker([49.10803, 11.68614], {
    icon: L.icon({
      iconUrl: 'icons/blue-dot.png',
      iconSize: [32, 32],
      iconAnchor: [16, 32]
    })
  }).addTo(map).bindPopup(`<b>Unterflurhydrant</b><br>ğŸ“‹ Unterflurhydrant Zum Spitzberg 3<br>ğŸ”§ Nenndurchmesser DN: 80.0 mm<br>ğŸš’ FF Hamberg<br>ğŸ“ 49.108030, 11.686140<br><a href='https://maps.apple.com/?daddr=49.10803,11.68614' target='_blank'>ğŸ Apple Karten</a><br><a href='https://maps.google.com/?daddr=49.10803,11.68614' target='_blank'>ğŸ“± Google Maps</a>`);
  marker.hydrantType = 'unterflurhydrant';
  hydrantMarkers.push(marker);
  var marker = L.marker([49.10752, 11.68542], {
    icon: L.icon({
      iconUrl: 'icons/blue-dot.png',
      iconSize: [32, 32],
      iconAnchor: [16, 32]
    })
  }).addTo(map).bindPopup(`<b>Unterflurhydrant</b><br>ğŸ“‹ Unterflurhydrant Kreuzung Zum Spitzberg / RÃ¶thenweg<br>ğŸ”§ Nenndurchmesser DN: 125.0 mm<br>ğŸš’ FF Hamberg<br>ğŸ“ 49.107520, 11.685420<br><a href='https://maps.apple.com/?daddr=49.10752,11.68542' target='_blank'>ğŸ Apple Karten</a><br><a href='https://maps.google.com/?daddr=49.10752,11.68542' target='_blank'>ğŸ“± Google Maps</a>`);
  marker.hydrantType = 'unterflurhydrant';
  hydrantMarkers.push(marker);
  var marker = L.marker([49.10815, 11.68443], {
    icon: L.icon({
      iconUrl: 'icons/blue-dot.png',
      iconSize: [32, 32],
      iconAnchor: [16, 32]
    })
  }).addTo(map).bindPopup(`<b>Unterflurhydrant</b><br>ğŸ“‹ Unterflurhydrant RÃ¶thenweg 13<br>ğŸ”§ Nenndurchmesser DN: 80.0 mm<br>ğŸš’ FF Hamberg<br>ğŸ“ 49.108150, 11.684430<br><a href='https://maps.apple.com/?daddr=49.10815,11.68443' target='_blank'>ğŸ Apple Karten</a><br><a href='https://maps.google.com/?daddr=49.10815,11.68443' target='_blank'>ğŸ“± Google Maps</a>`);
  marker.hydrantType = 'unterflurhydrant';
  hydrantMarkers.push(marker);
  var marker = L.marker([49.10693, 11.68444], {
    icon: L.icon({
      iconUrl: 'icons/blue-dot.png',
      iconSize: [32, 32],
      iconAnchor: [16, 32]
    })
  }).addTo(map).bindPopup(`<b>Unterflurhydrant</b><br>ğŸ“‹ Unterflurhydrant Zum Spitzberg 10<br>ğŸ”§ Nenndurchmesser DN: 100.0 mm<br>ğŸš’ FF Hamberg<br>ğŸ“ 49.106930, 11.684440<br><a href='https://maps.apple.com/?daddr=49.10693,11.68444' target='_blank'>ğŸ Apple Karten</a><br><a href='https://maps.google.com/?daddr=49.10693,11.68444' target='_blank'>ğŸ“± Google Maps</a>`);
  marker.hydrantType = 'unterflurhydrant';
  hydrantMarkers.push(marker);
  var marker = L.marker([49.10738, 11.68313], {
    icon: L.icon({
      iconUrl: 'icons/blue-dot.png',
      iconSize: [32, 32],
      iconAnchor: [16, 32]
    })
  }).addTo(map).bindPopup(`<b>Unterflurhydrant</b><br>ğŸ“‹ Unterflurhydrant Sonnenring 14<br>ğŸ”§ Nenndurchmesser DN: 100.0 mm<br>ğŸš’ FF Hamberg<br>ğŸ“ 49.107380, 11.683130<br><a href='https://maps.apple.com/?daddr=49.10738,11.68313' target='_blank'>ğŸ Apple Karten</a><br><a href='https://maps.google.com/?daddr=49.10738,11.68313' target='_blank'>ğŸ“± Google Maps</a>`);
  marker.hydrantType = 'unterflurhydrant';
  hydrantMarkers.push(marker);
  var marker = L.marker([49.10664, 11.68528], {
    icon: L.icon({
      iconUrl: 'icons/blue-dot.png',
      iconSize: [32, 32],
      iconAnchor: [16, 32]
    })
  }).addTo(map).bindPopup(`<b>Unterflurhydrant</b><br>ğŸ“‹ Unterflurhydrant Kiefergasse 5<br>ğŸ”§ Nenndurchmesser DN: 80.0 mm<br>ğŸš’ FF Hamberg<br>ğŸ“ 49.106640, 11.685280<br><a href='https://maps.apple.com/?daddr=49.10664,11.68528' target='_blank'>ğŸ Apple Karten</a><br><a href='https://maps.google.com/?daddr=49.10664,11.68528' target='_blank'>ğŸ“± Google Maps</a>`);
  marker.hydrantType = 'unterflurhydrant';
  hydrantMarkers.push(marker);
  var marker = L.marker([49.10597, 11.68546], {
    icon: L.icon({
      iconUrl: 'icons/blue-dot.png',
      iconSize: [32, 32],
      iconAnchor: [16, 32]
    })
  }).addTo(map).bindPopup(`<b>Unterflurhydrant</b><br>ğŸ“‹ Unterflurhydrant Rascher Str. 13<br>ğŸ”§ Nenndurchmesser DN: 80.0 mm<br>ğŸš’ FF Hamberg<br>ğŸ“ 49.105970, 11.685460<br><a href='https://maps.apple.com/?daddr=49.10597,11.68546' target='_blank'>ğŸ Apple Karten</a><br><a href='https://maps.google.com/?daddr=49.10597,11.68546' target='_blank'>ğŸ“± Google Maps</a>`);
  marker.hydrantType = 'unterflurhydrant';
  hydrantMarkers.push(marker);
  var marker = L.marker([49.1055, 11.68611], {
    icon: L.icon({
      iconUrl: 'icons/blue-dot.png',
      iconSize: [32, 32],
      iconAnchor: [16, 32]
    })
  }).addTo(map).bindPopup(`<b>Unterflurhydrant</b><br>ğŸ“‹ Unterflurhydrant Rascher Str. 9<br>ğŸ”§ Nenndurchmesser DN: 80.0 mm<br>ğŸš’ FF Hamberg<br>ğŸ“ 49.105500, 11.686110<br><a href='https://maps.apple.com/?daddr=49.1055,11.68611' target='_blank'>ğŸ Apple Karten</a><br><a href='https://maps.google.com/?daddr=49.1055,11.68611' target='_blank'>ğŸ“± Google Maps</a>`);
  marker.hydrantType = 'unterflurhydrant';
  hydrantMarkers.push(marker);
  var marker = L.marker([49.10605, 11.6862], {
    icon: L.icon({
      iconUrl: 'icons/blue-dot.png',
      iconSize: [32, 32],
      iconAnchor: [16, 32]
    })
  }).addTo(map).bindPopup(`<b>Unterflurhydrant</b><br>ğŸ“‹ Unterflurhydrant RÃ¶thenweg 6<br>ğŸ”§ Nenndurchmesser DN: 100.0 mm<br>ğŸš’ FF Hamberg<br>ğŸ“ 49.106050, 11.686200<br><a href='https://maps.apple.com/?daddr=49.10605,11.6862' target='_blank'>ğŸ Apple Karten</a><br><a href='https://maps.google.com/?daddr=49.10605,11.6862' target='_blank'>ğŸ“± Google Maps</a>`);
  marker.hydrantType = 'unterflurhydrant';
  hydrantMarkers.push(marker);
  var marker = L.marker([49.10668, 11.68604], {
    icon: L.icon({
      iconUrl: 'icons/blue-dot.png',
      iconSize: [32, 32],
      iconAnchor: [16, 32]
    })
  }).addTo(map).bindPopup(`<b>Unterflurhydrant</b><br>ğŸ“‹ Unterflurhydrant RÃ¶thenweg<br>ğŸ”§ Nenndurchmesser DN: 80.0 mm<br>ğŸš’ FF Hamberg<br>ğŸ“ 49.106680, 11.686040<br><a href='https://maps.apple.com/?daddr=49.10668,11.68604' target='_blank'>ğŸ Apple Karten</a><br><a href='https://maps.google.com/?daddr=49.10668,11.68604' target='_blank'>ğŸ“± Google Maps</a>`);
  marker.hydrantType = 'unterflurhydrant';
  hydrantMarkers.push(marker);
  var marker = L.marker([49.10786, 11.68775], {
    icon: L.icon({
      iconUrl: 'icons/blue-dot.png',
      iconSize: [32, 32],
      iconAnchor: [16, 32]
    })
  }).addTo(map).bindPopup(`<b>Unterflurhydrant</b><br>ğŸ“‹ Unterflurhydrant HauptstraÃŸe 17<br>ğŸ”§ Nenndurchmesser DN: 125.0 mm<br>ğŸš’ FF Hamberg<br>ğŸ“ 49.107860, 11.687750<br><a href='https://maps.apple.com/?daddr=49.10786,11.68775' target='_blank'>ğŸ Apple Karten</a><br><a href='https://maps.google.com/?daddr=49.10786,11.68775' target='_blank'>ğŸ“± Google Maps</a>`);
  marker.hydrantType = 'unterflurhydrant';
  hydrantMarkers.push(marker);
  var marker = L.marker([49.1068, 11.68672], {
    icon: L.icon({
      iconUrl: 'icons/red-dot.png',
      iconSize: [32, 32],
      iconAnchor: [16, 32]
    })
  }).addTo(map).bindPopup(`<b>Ãœberflurhydrant</b><br>ğŸ“‹ Ãœberflurhydrant HauptstraÃŸe 28<br>ğŸ”§ Nenndurchmesser DN: 80.0 mm<br>ğŸš’ FF Hamberg<br>ğŸ“ 49.106800, 11.686720<br><a href='https://maps.apple.com/?daddr=49.1068,11.68672' target='_blank'>ğŸ Apple Karten</a><br><a href='https://maps.google.com/?daddr=49.1068,11.68672' target='_blank'>ğŸ“± Google Maps</a>`);
  marker.hydrantType = 'Ã¼berflurhydrant';
  hydrantMarkers.push(marker);
  var marker = L.marker([49.1063, 11.68724], {
    icon: L.icon({
      iconUrl: 'icons/blue-dot.png',
      iconSize: [32, 32],
      iconAnchor: [16, 32]
    })
  }).addTo(map).bindPopup(`<b>Unterflurhydrant</b><br>ğŸ“‹ Unterflurhydrant HauptstraÃŸe 21b<br>ğŸ”§ Nenndurchmesser DN: 125.0 mm<br>ğŸš’ FF Hamberg<br>ğŸ“ 49.106300, 11.687240<br><a href='https://maps.apple.com/?daddr=49.1063,11.68724' target='_blank'>ğŸ Apple Karten</a><br><a href='https://maps.google.com/?daddr=49.1063,11.68724' target='_blank'>ğŸ“± Google Maps</a>`);
  marker.hydrantType = 'unterflurhydrant';
  hydrantMarkers.push(marker);
  var marker = L.marker([49.10557, 11.68756], {
    icon: L.icon({
      iconUrl: 'icons/blue-dot.png',
      iconSize: [32, 32],
      iconAnchor: [16, 32]
    })
  }).addTo(map).bindPopup(`<b>Unterflurhydrant</b><br>ğŸ“‹ Unterflurhydrant HauptstraÃŸe 25<br>ğŸ”§ Nenndurchmesser DN: 125.0 mm<br>ğŸš’ FF Hamberg<br>ğŸ“ 49.105570, 11.687560<br><a href='https://maps.apple.com/?daddr=49.10557,11.68756' target='_blank'>ğŸ Apple Karten</a><br><a href='https://maps.google.com/?daddr=49.10557,11.68756' target='_blank'>ğŸ“± Google Maps</a>`);
  marker.hydrantType = 'unterflurhydrant';
  hydrantMarkers.push(marker);
  var marker = L.marker([49.10483, 11.68749], {
    icon: L.icon({
      iconUrl: 'icons/red-dot.png',
      iconSize: [32, 32],
      iconAnchor: [16, 32]
    })
  }).addTo(map).bindPopup(`<b>Ãœberflurhydrant</b><br>ğŸ“‹ Ãœberflurhydrant HauptstraÃŸe 29<br>ğŸ”§ Nenndurchmesser DN: 80.0 mm<br>ğŸš’ FF Hamberg<br>ğŸ“ 49.104830, 11.687490<br><a href='https://maps.apple.com/?daddr=49.10483,11.68749' target='_blank'>ğŸ Apple Karten</a><br><a href='https://maps.google.com/?daddr=49.10483,11.68749' target='_blank'>ğŸ“± Google Maps</a>`);
  marker.hydrantType = 'Ã¼berflurhydrant';
  hydrantMarkers.push(marker);
  var marker = L.marker([49.10502, 11.68894], {
    icon: L.icon({
      iconUrl: 'icons/blue-dot.png',
      iconSize: [32, 32],
      iconAnchor: [16, 32]
    })
  }).addTo(map).bindPopup(`<b>Unterflurhydrant</b><br>ğŸ“‹ Unterflurhydrant Herrnrieder Str. 2<br>ğŸ”§ Nenndurchmesser DN: 100.0 mm<br>ğŸš’ FF Hamberg<br>ğŸ“ 49.105020, 11.688940<br><a href='https://maps.apple.com/?daddr=49.10502,11.68894' target='_blank'>ğŸ Apple Karten</a><br><a href='https://maps.google.com/?daddr=49.10502,11.68894' target='_blank'>ğŸ“± Google Maps</a>`);
  marker.hydrantType = 'unterflurhydrant';
  hydrantMarkers.push(marker);
  var marker = L.marker([49.10279, 11.68877], {
    icon: L.icon({
      iconUrl: 'icons/red-dot.png',
      iconSize: [32, 32],
      iconAnchor: [16, 32]
    })
  }).addTo(map).bindPopup(`<b>Ãœberflurhydrant</b><br>ğŸ“‹ Ãœberflurhydrant Eichlberger Str. 12<br>ğŸ”§ Nenndurchmesser DN: 80.0 mm<br>ğŸš’ FF Hamberg<br>ğŸ“ 49.102790, 11.688770<br><a href='https://maps.apple.com/?daddr=49.10279,11.68877' target='_blank'>ğŸ Apple Karten</a><br><a href='https://maps.google.com/?daddr=49.10279,11.68877' target='_blank'>ğŸ“± Google Maps</a>`);
  marker.hydrantType = 'Ã¼berflurhydrant';
  hydrantMarkers.push(marker);
  var marker = L.marker([49.10373, 11.6877], {
    icon: L.icon({
      iconUrl: 'icons/red-dot.png',
      iconSize: [32, 32],
      iconAnchor: [16, 32]
    })
  }).addTo(map).bindPopup(`<b>Ãœberflurhydrant</b><br>ğŸ“‹ Ãœberflurhydrant Eichlberger Str. 3<br>ğŸ”§ Nenndurchmesser DN: 80.0 mm<br>ğŸš’ FF Hamberg<br>ğŸ“ 49.103730, 11.687700<br><a href='https://maps.apple.com/?daddr=49.10373,11.6877' target='_blank'>ğŸ Apple Karten</a><br><a href='https://maps.google.com/?daddr=49.10373,11.6877' target='_blank'>ğŸ“± Google Maps</a>`);
  marker.hydrantType = 'Ã¼berflurhydrant';
  hydrantMarkers.push(marker);
  var marker = L.marker([49.1043, 11.68642], {
    icon: L.icon({
      iconUrl: 'icons/blue-dot.png',
      iconSize: [32, 32],
      iconAnchor: [16, 32]
    })
  }).addTo(map).bindPopup(`<b>Unterflurhydrant</b><br>ğŸ“‹ Unterflurhydrant HauptstraÃŸe 35<br>ğŸ”§ Nenndurchmesser DN: 100.0 mm<br>ğŸš’ FF Hamberg<br>ğŸ“ 49.104300, 11.686420<br><a href='https://maps.apple.com/?daddr=49.1043,11.68642' target='_blank'>ğŸ Apple Karten</a><br><a href='https://maps.google.com/?daddr=49.1043,11.68642' target='_blank'>ğŸ“± Google Maps</a>`);
  marker.hydrantType = 'unterflurhydrant';
  hydrantMarkers.push(marker);
  var marker = L.marker([49.10412, 11.68603], {
    icon: L.icon({
      iconUrl: 'icons/blue-dot.png',
      iconSize: [32, 32],
      iconAnchor: [16, 32]
    })
  }).addTo(map).bindPopup(`<b>Unterflurhydrant</b><br>ğŸ“‹ Unterflurhydrant HauptstraÃŸe 37<br>ğŸ”§ Nenndurchmesser DN: 80.0 mm<br>ğŸš’ FF Hamberg<br>ğŸ“ 49.104120, 11.686030<br><a href='https://maps.apple.com/?daddr=49.10412,11.68603' target='_blank'>ğŸ Apple Karten</a><br><a href='https://maps.google.com/?daddr=49.10412,11.68603' target='_blank'>ğŸ“± Google Maps</a>`);
  marker.hydrantType = 'unterflurhydrant';
  hydrantMarkers.push(marker);
  var marker = L.marker([49.10355, 11.68542], {
    icon: L.icon({
      iconUrl: 'icons/blue-dot.png',
      iconSize: [32, 32],
      iconAnchor: [16, 32]
    })
  }).addTo(map).bindPopup(`<b>Unterflurhydrant</b><br>ğŸ“‹ Unterflurhydrant HauptstraÃŸe 41<br>ğŸ”§ Nenndurchmesser DN: 80.0 mm<br>ğŸš’ FF Hamberg<br>ğŸ“ 49.103550, 11.685420<br><a href='https://maps.apple.com/?daddr=49.10355,11.68542' target='_blank'>ğŸ Apple Karten</a><br><a href='https://maps.google.com/?daddr=49.10355,11.68542' target='_blank'>ğŸ“± Google Maps</a>`);
  marker.hydrantType = 'unterflurhydrant';
  hydrantMarkers.push(marker);
  var marker = L.marker([49.10372, 11.68505], {
    icon: L.icon({
      iconUrl: 'icons/blue-dot.png',
      iconSize: [32, 32],
      iconAnchor: [16, 32]
    })
  }).addTo(map).bindPopup(`<b>Unterflurhydrant</b><br>ğŸ“‹ Unterflurhydrant HauptstraÃŸe 46<br>ğŸ”§ Nenndurchmesser DN: 80.0 mm<br>ğŸš’ FF Hamberg<br>ğŸ“ 49.103720, 11.685050<br><a href='https://maps.apple.com/?daddr=49.10372,11.68505' target='_blank'>ğŸ Apple Karten</a><br><a href='https://maps.google.com/?daddr=49.10372,11.68505' target='_blank'>ğŸ“± Google Maps</a>`);
  marker.hydrantType = 'unterflurhydrant';
  hydrantMarkers.push(marker);
  var marker = L.marker([49.10288, 11.68749], {
    icon: L.icon({
      iconUrl: 'icons/blue-dot.png',
      iconSize: [32, 32],
      iconAnchor: [16, 32]
    })
  }).addTo(map).bindPopup(`<b>Unterflurhydrant</b><br>ğŸ“‹ Unterflurhydrant Eichlberger Str. 12<br>ğŸ”§ Nenndurchmesser DN: 125.0 mm<br>ğŸš’ FF Hamberg<br>ğŸ“ 49.102880, 11.687490<br><a href='https://maps.apple.com/?daddr=49.10288,11.68749' target='_blank'>ğŸ Apple Karten</a><br><a href='https://maps.google.com/?daddr=49.10288,11.68749' target='_blank'>ğŸ“± Google Maps</a>`);
  marker.hydrantType = 'unterflurhydrant';
  hydrantMarkers.push(marker);
  var marker = L.marker([49.10367, 11.68839], {
    icon: L.icon({
      iconUrl: 'icons/blue-dot.png',
      iconSize: [32, 32],
      iconAnchor: [16, 32]
    })
  }).addTo(map).bindPopup(`<b>Unterflurhydrant</b><br>ğŸ“‹ Unterflurhydrant Eichlberger Str. 4<br>ğŸ”§ Nenndurchmesser DN: 100.0 mm<br>ğŸš’ FF Hamberg<br>ğŸ“ 49.103670, 11.688390<br><a href='https://maps.apple.com/?daddr=49.10367,11.68839' target='_blank'>ğŸ Apple Karten</a><br><a href='https://maps.google.com/?daddr=49.10367,11.68839' target='_blank'>ğŸ“± Google Maps</a>`);
  marker.hydrantType = 'unterflurhydrant';
  hydrantMarkers.push(marker);
  var marker = L.marker([49.11046, 11.67008], {
    icon: L.icon({
      iconUrl: 'icons/red-dot.png',
      iconSize: [32, 32],
      iconAnchor: [16, 32]
    })
  }).addTo(map).bindPopup(`<b>Ãœberflurhydrant</b><br>ğŸ“‹ Ãœberflurhydrant Ã–dberg 1<br>ğŸ”§ Nenndurchmesser DN: 80.0 mm<br>ğŸš’ FF Hamberg<br>ğŸ“ 49.110460, 11.670080<br><a href='https://maps.apple.com/?daddr=49.11046,11.67008' target='_blank'>ğŸ Apple Karten</a><br><a href='https://maps.google.com/?daddr=49.11046,11.67008' target='_blank'>ğŸ“± Google Maps</a>`);
  marker.hydrantType = 'Ã¼berflurhydrant';
  hydrantMarkers.push(marker);
  var marker = L.marker([49.11063, 11.67348], {
    icon: L.icon({
      iconUrl: 'icons/blue-dot.png',
      iconSize: [32, 32],
      iconAnchor: [16, 32]
    })
  }).addTo(map).bindPopup(`<b>Unterflurhydrant</b><br>ğŸ“‹ Unterflurhydrant Ã–dberg 3<br>ğŸ”§ Nenndurchmesser DN: 80.0 mm<br>ğŸš’ FF Hamberg<br>ğŸ“ 49.110630, 11.673480<br><a href='https://maps.apple.com/?daddr=49.11063,11.67348' target='_blank'>ğŸ Apple Karten</a><br><a href='https://maps.google.com/?daddr=49.11063,11.67348' target='_blank'>ğŸ“± Google Maps</a>`);
  marker.hydrantType = 'unterflurhydrant';
  hydrantMarkers.push(marker);
  var marker = L.marker([49.1111, 11.67341], {
    icon: L.icon({
      iconUrl: 'icons/red-dot.png',
      iconSize: [32, 32],
      iconAnchor: [16, 32]
    })
  }).addTo(map).bindPopup(`<b>Ãœberflurhydrant</b><br>ğŸ“‹ Ãœberflurhydrant Ã–dberg 4<br>ğŸ”§ Nenndurchmesser DN: 80.0 mm<br>ğŸš’ FF Hamberg<br>ğŸ“ 49.111100, 11.673410<br><a href='https://maps.apple.com/?daddr=49.1111,11.67341' target='_blank'>ğŸ Apple Karten</a><br><a href='https://maps.google.com/?daddr=49.1111,11.67341' target='_blank'>ğŸ“± Google Maps</a>`);
  marker.hydrantType = 'Ã¼berflurhydrant';
  hydrantMarkers.push(marker);
  var marker = L.marker([49.11035, 11.6837], {
    icon: L.icon({
      iconUrl: 'icons/blue-dot.png',
      iconSize: [32, 32],
      iconAnchor: [16, 32]
    })
  }).addTo(map).bindPopup(`<b>Unterflurhydrant</b><br>ğŸ“‹ Unterflurhydrant Sportplatz<br>ğŸ”§ Nenndurchmesser DN: 80.0 mm<br>ğŸš’ FF Hamberg<br>ğŸ“ 49.110350, 11.683700<br><a href='https://maps.apple.com/?daddr=49.11035,11.6837' target='_blank'>ğŸ Apple Karten</a><br><a href='https://maps.google.com/?daddr=49.11035,11.6837' target='_blank'>ğŸ“± Google Maps</a>`);
  marker.hydrantType = 'unterflurhydrant';
  hydrantMarkers.push(marker);
  var marker = L.marker([49.11208, 11.68469], {
    icon: L.icon({
      iconUrl: 'icons/blue-dot.png',
      iconSize: [32, 32],
      iconAnchor: [16, 32]
    })
  }).addTo(map).bindPopup(`<b>Unterflurhydrant</b><br>ğŸ“‹ Unterflurhydrant Kreuzung ReitstraÃŸe/Spanbergweg<br>ğŸ”§ Nenndurchmesser DN: 80.0 mm<br>ğŸš’ FF Hamberg<br>ğŸ“ 49.112080, 11.684690<br><a href='https://maps.apple.com/?daddr=49.11208,11.68469' target='_blank'>ğŸ Apple Karten</a><br><a href='https://maps.google.com/?daddr=49.11208,11.68469' target='_blank'>ğŸ“± Google Maps</a>`);
  marker.hydrantType = 'unterflurhydrant';
  hydrantMarkers.push(marker);
  var marker = L.marker([49.11304, 11.68592], {
    icon: L.icon({
      iconUrl: 'icons/red-dot.png',
      iconSize: [32, 32],
      iconAnchor: [16, 32]
    })
  }).addTo(map).bindPopup(`<b>Ãœberflurhydrant</b><br>ğŸ“‹ Ãœberflurhydrant Gabelung ReitstraÃŸe/Winner Str.<br>ğŸ”§ Nenndurchmesser DN: 80.0 mm<br>ğŸš’ FF Hamberg<br>ğŸ“ 49.113040, 11.685920<br><a href='https://maps.apple.com/?daddr=49.11304,11.68592' target='_blank'>ğŸ Apple Karten</a><br><a href='https://maps.google.com/?daddr=49.11304,11.68592' target='_blank'>ğŸ“± Google Maps</a>`);
  marker.hydrantType = 'Ã¼berflurhydrant';
  hydrantMarkers.push(marker);
  var marker = L.marker([49.11292, 11.68668], {
    icon: L.icon({
      iconUrl: 'icons/red-dot.png',
      iconSize: [32, 32],
      iconAnchor: [16, 32]
    })
  }).addTo(map).bindPopup(`<b>Ãœberflurhydrant</b><br>ğŸ“‹ Ãœberflurhydrant BushÃ¤uschen SchnÃ¶dorf<br>ğŸ”§ Nenndurchmesser DN: 80.0 mm<br>ğŸš’ FF Hamberg<br>ğŸ“ 49.112920, 11.686680<br><a href='https://maps.apple.com/?daddr=49.11292,11.68668' target='_blank'>ğŸ Apple Karten</a><br><a href='https://maps.google.com/?daddr=49.11292,11.68668' target='_blank'>ğŸ“± Google Maps</a>`);
  marker.hydrantType = 'Ã¼berflurhydrant';
  hydrantMarkers.push(marker);
  var marker = L.marker([49.11328, 11.68606], {
    icon: L.icon({
      iconUrl: 'icons/blue-dot.png',
      iconSize: [32, 32],
      iconAnchor: [16, 32]
    })
  }).addTo(map).bindPopup(`<b>Unterflurhydrant</b><br>ğŸ“‹ Unterflurhydrant Winner Str. 1<br>ğŸ”§ Nenndurchmesser DN: 80.0 mm<br>ğŸš’ FF Hamberg<br>ğŸ“ 49.113280, 11.686060<br><a href='https://maps.apple.com/?daddr=49.11328,11.68606' target='_blank'>ğŸ Apple Karten</a><br><a href='https://maps.google.com/?daddr=49.11328,11.68606' target='_blank'>ğŸ“± Google Maps</a>`);
  marker.hydrantType = 'unterflurhydrant';
  hydrantMarkers.push(marker);
  var marker = L.marker([49.11447, 11.6874], {
    icon: L.icon({
      iconUrl: 'icons/blue-dot.png',
      iconSize: [32, 32],
      iconAnchor: [16, 32]
    })
  }).addTo(map).bindPopup(`<b>Unterflurhydrant</b><br>ğŸ“‹ Unterflurhydrant Winner Str. 6<br>ğŸ”§ Nenndurchmesser DN: 80.0 mm<br>ğŸš’ FF Hamberg<br>ğŸ“ 49.114470, 11.687400<br><a href='https://maps.apple.com/?daddr=49.11447,11.6874' target='_blank'>ğŸ Apple Karten</a><br><a href='https://maps.google.com/?daddr=49.11447,11.6874' target='_blank'>ğŸ“± Google Maps</a>`);
  marker.hydrantType = 'unterflurhydrant';
  hydrantMarkers.push(marker);
  var marker = L.marker([49.11339, 11.68766], {
    icon: L.icon({
      iconUrl: 'icons/red-dot.png',
      iconSize: [32, 32],
      iconAnchor: [16, 32]
    })
  }).addTo(map).bindPopup(`<b>Ãœberflurhydrant</b><br>ğŸ“‹ Ãœberflurhydrant ReitstraÃŸe 20<br>ğŸ”§ Nenndurchmesser DN: 80.0 mm<br>ğŸš’ FF Hamberg<br>ğŸ“ 49.113390, 11.687660<br><a href='https://maps.apple.com/?daddr=49.11339,11.68766' target='_blank'>ğŸ Apple Karten</a><br><a href='https://maps.google.com/?daddr=49.11339,11.68766' target='_blank'>ğŸ“± Google Maps</a>`);
  marker.hydrantType = 'Ã¼berflurhydrant';
  hydrantMarkers.push(marker);
  var marker = L.marker([49.11098, 11.68577], {
    icon: L.icon({
      iconUrl: 'icons/blue-dot.png',
      iconSize: [32, 32],
      iconAnchor: [16, 32]
    })
  }).addTo(map).bindPopup(`<b>Unterflurhydrant</b><br>ğŸ“‹ Unterflurhydrant Hohe Trift 5<br>ğŸ”§ Nenndurchmesser DN: 80.0 mm<br>ğŸš’ FF Hamberg<br>ğŸ“ 49.110980, 11.685770<br><a href='https://maps.apple.com/?daddr=49.11098,11.68577' target='_blank'>ğŸ Apple Karten</a><br><a href='https://maps.google.com/?daddr=49.11098,11.68577' target='_blank'>ğŸ“± Google Maps</a>`);
  marker.hydrantType = 'unterflurhydrant';
  hydrantMarkers.push(marker);
  var marker = L.marker([49.11124, 11.68644], {
    icon: L.icon({
      iconUrl: 'icons/blue-dot.png',
      iconSize: [32, 32],
      iconAnchor: [16, 32]
    })
  }).addTo(map).bindPopup(`<b>Unterflurhydrant</b><br>ğŸ“‹ Unterflurhydrant Hohe Trift 2, EinmÃ¼ndung Spanbergweg<br>ğŸ”§ Nenndurchmesser DN: 150.0 mm<br>ğŸš’ FF Hamberg<br>ğŸ“ 49.111240, 11.686440<br><a href='https://maps.apple.com/?daddr=49.11124,11.68644' target='_blank'>ğŸ Apple Karten</a><br><a href='https://maps.google.com/?daddr=49.11124,11.68644' target='_blank'>ğŸ“± Google Maps</a>`);
  marker.hydrantType = 'unterflurhydrant';
  hydrantMarkers.push(marker);
  var marker = L.marker([49.11065, 11.68653], {
    icon: L.icon({
      iconUrl: 'icons/blue-dot.png',
      iconSize: [32, 32],
      iconAnchor: [16, 32]
    })
  }).addTo(map).bindPopup(`<b>Unterflurhydrant</b><br>ğŸ“‹ Unterflurhydrant HauptstraÃŸe 1<br>ğŸ”§ Nenndurchmesser DN: 150.0 mm<br>ğŸš’ FF Hamberg<br>ğŸ“ 49.110650, 11.686530<br><a href='https://maps.apple.com/?daddr=49.11065,11.68653' target='_blank'>ğŸ Apple Karten</a><br><a href='https://maps.google.com/?daddr=49.11065,11.68653' target='_blank'>ğŸ“± Google Maps</a>`);
  marker.hydrantType = 'unterflurhydrant';
  hydrantMarkers.push(marker);
  var marker = L.marker([49.11, 11.68699], {
    icon: L.icon({
      iconUrl: 'icons/blue-dot.png',
      iconSize: [32, 32],
      iconAnchor: [16, 32]
    })
  }).addTo(map).bindPopup(`<b>Unterflurhydrant</b><br>ğŸ“‹ Unterflurhydrant HauptstraÃŸe 3<br>ğŸ”§ Nenndurchmesser DN: 100.0 mm<br>ğŸš’ FF Hamberg<br>ğŸ“ 49.110000, 11.686990<br><a href='https://maps.apple.com/?daddr=49.11,11.68699' target='_blank'>ğŸ Apple Karten</a><br><a href='https://maps.google.com/?daddr=49.11,11.68699' target='_blank'>ğŸ“± Google Maps</a>`);
  marker.hydrantType = 'unterflurhydrant';
  hydrantMarkers.push(marker);
  var marker = L.marker([49.1091, 11.68704], {
    icon: L.icon({
      iconUrl: 'icons/red-dot.png',
      iconSize: [32, 32],
      iconAnchor: [16, 32]
    })
  }).addTo(map).bindPopup(`<b>Ãœberflurhydrant</b><br>ğŸ“‹ Ãœberflurhydrant HauptstraÃŸe 10<br>ğŸ”§ Nenndurchmesser DN: 80.0 mm<br>ğŸš’ FF Hamberg<br>ğŸ“ 49.109100, 11.687040<br><a href='https://maps.apple.com/?daddr=49.1091,11.68704' target='_blank'>ğŸ Apple Karten</a><br><a href='https://maps.google.com/?daddr=49.1091,11.68704' target='_blank'>ğŸ“± Google Maps</a>`);
  marker.hydrantType = 'Ã¼berflurhydrant';
  hydrantMarkers.push(marker);
  var marker = L.marker([49.10941, 11.68767], {
    icon: L.icon({
      iconUrl: 'icons/yellow-dot.png',
      iconSize: [32, 32],
      iconAnchor: [16, 32]
    })
  }).addTo(map).bindPopup(`<b>WasserbehÃ¤lter</b><br>ğŸ“‹ LÃ¶schwasserbehÃ¤lter Talweg, EinmÃ¼ndung Pfarrgasse<br>ğŸš’ FF Hamberg<br>ğŸ“ 49.109410, 11.687670<br><a href='https://maps.apple.com/?daddr=49.10941,11.68767' target='_blank'>ğŸ Apple Karten</a><br><a href='https://maps.google.com/?daddr=49.10941,11.68767' target='_blank'>ğŸ“± Google Maps</a>`);
  marker.hydrantType = 'wasserbehÃ¤lter';
  hydrantMarkers.push(marker);
  var marker = L.marker([49.10881, 11.68816], {
    icon: L.icon({
      iconUrl: 'icons/blue-dot.png',
      iconSize: [32, 32],
      iconAnchor: [16, 32]
    })
  }).addTo(map).bindPopup(`<b>Unterflurhydrant</b><br>ğŸ“‹ Unterflurhydrant Pfarrgasse 4<br>ğŸ”§ Nenndurchmesser DN: 100.0 mm<br>ğŸš’ FF Hamberg<br>ğŸ“ 49.108810, 11.688160<br><a href='https://maps.apple.com/?daddr=49.10881,11.68816' target='_blank'>ğŸ Apple Karten</a><br><a href='https://maps.google.com/?daddr=49.10881,11.68816' target='_blank'>ğŸ“± Google Maps</a>`);
  marker.hydrantType = 'unterflurhydrant';
  hydrantMarkers.push(marker);
  var marker = L.marker([49.11375, 11.69697], {
    icon: L.icon({
      iconUrl: 'icons/red-dot.png',
      iconSize: [32, 32],
      iconAnchor: [16, 32]
    })
  }).addTo(map).bindPopup(`<b>Ãœberflurhydrant</b><br>ğŸ“‹ Ãœberflurhydrant Rofen<br>ğŸ”§ Nenndurchmesser DN: 80.0 mm<br>ğŸš’ FF Hamberg<br>ğŸ“ 49.113750, 11.696970<br><a href='https://maps.apple.com/?daddr=49.11375,11.69697' target='_blank'>ğŸ Apple Karten</a><br><a href='https://maps.google.com/?daddr=49.11375,11.69697' target='_blank'>ğŸ“± Google Maps</a>`);
  marker.hydrantType = 'Ã¼berflurhydrant';
  hydrantMarkers.push(marker);
  var marker = L.marker([49.11399, 11.69562], {
    icon: L.icon({
      iconUrl: 'icons/blue-dot.png',
      iconSize: [32, 32],
      iconAnchor: [16, 32]
    })
  }).addTo(map).bindPopup(`<b>Unterflurhydrant</b><br>ğŸ“‹ Unterflurhydrant Rofen<br>ğŸ”§ Nenndurchmesser DN: 80.0 mm<br>ğŸš’ FF Hamberg<br>ğŸ“ 49.113990, 11.695620<br><a href='https://maps.apple.com/?daddr=49.11399,11.69562' target='_blank'>ğŸ Apple Karten</a><br><a href='https://maps.google.com/?daddr=49.11399,11.69562' target='_blank'>ğŸ“± Google Maps</a>`);
  marker.hydrantType = 'unterflurhydrant';
  hydrantMarkers.push(marker);
  var marker = L.marker([49.10078, 11.68323], {
    icon: L.icon({
      iconUrl: 'icons/red-dot.png',
      iconSize: [32, 32],
      iconAnchor: [16, 32]
    })
  }).addTo(map).bindPopup(`<b>Ãœberflurhydrant</b><br>ğŸ“‹ Ãœberflurhydrant ZiegelhÃ¼tte 1<br>ğŸ”§ Nenndurchmesser DN: 80.0 mm<br>ğŸš’ FF Hamberg<br>ğŸ“ 49.100780, 11.683230<br><a href='https://maps.apple.com/?daddr=49.10078,11.68323' target='_blank'>ğŸ Apple Karten</a><br><a href='https://maps.google.com/?daddr=49.10078,11.68323' target='_blank'>ğŸ“± Google Maps</a>`);
  marker.hydrantType = 'Ã¼berflurhydrant';
  hydrantMarkers.push(marker);
  var marker = L.marker([49.10849, 11.68725], {
    icon: L.icon({
      iconUrl: 'icons/blue-dot.png',
      iconSize: [32, 32],
      iconAnchor: [16, 32]
    })
  }).addTo(map).bindPopup(`<b>Unterflurhydrant</b><br>ğŸ“‹ Unterflurhydrant Kirche<br>ğŸ”§ Nenndurchmesser DN: 80.0 mm<br>ğŸš’ FF Hamberg<br>ğŸ“ 49.108490, 11.687250<br><a href='https://maps.apple.com/?daddr=49.10849,11.68725' target='_blank'>ğŸ Apple Karten</a><br><a href='https://maps.google.com/?daddr=49.10849,11.68725' target='_blank'>ğŸ“± Google Maps</a>`);
  marker.hydrantType = 'unterflurhydrant';
  hydrantMarkers.push(marker);
  var marker = L.marker([49.092199, 11.70373], {
    icon: L.icon({
      iconUrl: 'icons/green-dot.png',
      iconSize: [32, 32],
      iconAnchor: [16, 32]
    })
  }).addTo(map).bindPopup(`<b>Rettungspunkt</b><br>ğŸ“‹ Rettungspunkt Schafsee Hamberg/Eichlberg<br>ğŸš’ FF Hamberg<br>ğŸ“ 49.092199, 11.703730<br><a href='https://maps.apple.com/?daddr=49.092199,11.70373' target='_blank'>ğŸ Apple Karten</a><br><a href='https://maps.google.com/?daddr=49.092199,11.70373' target='_blank'>ğŸ“± Google Maps</a>`);
  marker.hydrantType = 'rettungspunkt';
  hydrantMarkers.push(marker);
  var marker = L.marker([49.086695, 11.66433953], {
    icon: L.icon({
      iconUrl: 'icons/green-dot.png',
      iconSize: [32, 32],
      iconAnchor: [16, 32]
    })
  }).addTo(map).bindPopup(`<b>Rettungspunkt</b><br>ğŸ“‹ Rettungspunkt NM-2131 Langenthonhausen<br>ğŸš’ FF Hamberg<br>ğŸ“ 49.086695, 11.664340<br><a href='https://maps.apple.com/?daddr=49.086695,11.66433953' target='_blank'>ğŸ Apple Karten</a><br><a href='https://maps.google.com/?daddr=49.086695,11.66433953' target='_blank'>ğŸ“± Google Maps</a>`);
  marker.hydrantType = 'rettungspunkt';
  hydrantMarkers.push(marker);
  var marker = L.marker([49.10529568, 11.716126], {
    icon: L.icon({
      iconUrl: 'icons/green-dot.png',
      iconSize: [32, 32],
      iconAnchor: [16, 32]
    })
  }).addTo(map).bindPopup(`<b>Rettungspunkt</b><br>ğŸ“‹ Rettungspunkt Feuerwehrhaus Herrnried<br>ğŸš’ FF Hamberg<br>ğŸ“ 49.105296, 11.716126<br><a href='https://maps.apple.com/?daddr=49.10529568,11.716126' target='_blank'>ğŸ Apple Karten</a><br><a href='https://maps.google.com/?daddr=49.10529568,11.716126' target='_blank'>ğŸ“± Google Maps</a>`);
  marker.hydrantType = 'rettungspunkt';
  hydrantMarkers.push(marker);
  var marker = L.marker([49.11173709, 11.66721575], {
    icon: L.icon({
      iconUrl: 'icons/green-dot.png',
      iconSize: [32, 32],
      iconAnchor: [16, 32]
    })
  }).addTo(map).bindPopup(`<b>Rettungspunkt</b><br>ğŸ“‹ Rettungspunkt NM-2171 Ã–dberg<br>ğŸš’ FF Hamberg<br>ğŸ“ 49.111737, 11.667216<br><a href='https://maps.apple.com/?daddr=49.11173709,11.66721575' target='_blank'>ğŸ Apple Karten</a><br><a href='https://maps.google.com/?daddr=49.11173709,11.66721575' target='_blank'>ğŸ“± Google Maps</a>`);
  marker.hydrantType = 'rettungspunkt';
  hydrantMarkers.push(marker);
  var marker = L.marker([49.12040024, 11.71188973], {
    icon: L.icon({
      iconUrl: 'icons/green-dot.png',
      iconSize: [32, 32],
      iconAnchor: [16, 32]
    })
  }).addTo(map).bindPopup(`<b>Rettungspunkt</b><br>ğŸ“‹ Rettungspunkt NM-2189 B8 Parkplatz<br>ğŸš’ FF Hamberg<br>ğŸ“ 49.120400, 11.711890<br><a href='https://maps.apple.com/?daddr=49.12040024,11.71188973' target='_blank'>ğŸ Apple Karten</a><br><a href='https://maps.google.com/?daddr=49.12040024,11.71188973' target='_blank'>ğŸ“± Google Maps</a>`);
  marker.hydrantType = 'rettungspunkt';
  hydrantMarkers.push(marker);
  
  console.log(`âœ… ${hydrantMarkers.length} 2D-Hydranten erstellt`);
}

window.addEventListener('load', function() {
  console.log('ğŸš’ Modulare Hydrantenkarte wird initialisiert...');
  
  // Check URL parameters
  const urlParams = new URLSearchParams(window.location.search);
  const sharedLat = urlParams.get('lat');
  const sharedLng = urlParams.get('lng');
  const sharedZoom = urlParams.get('zoom');
  const sharedMode = urlParams.get('mode');
  
  // Initialize 2D Map
  initialize2DMap();
  
  // Handle shared position
  if (sharedLat && sharedLng) {
    const lat = parseFloat(sharedLat);
    const lng = parseFloat(sharedLng);
    const zoom = sharedZoom ? parseInt(sharedZoom) : 17;
    
    console.log('ğŸ“ Geteilte Position erkannt:', lat, lng);
    
    if (map) {
      map.setView([lat, lng], zoom);
      
      L.marker([lat, lng], {
        icon: L.icon({
          iconUrl: 'data:image/svg+xml;base64,' + btoa(`
            <svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 32 32">
              <circle cx="16" cy="16" r="12" fill="#ff4444" stroke="#fff" stroke-width="2"/>
              <text x="16" y="21" text-anchor="middle" fill="white" font-size="16">ğŸš’</text>
            </svg>
          `),
          iconSize: [32, 32],
          iconAnchor: [16, 32]
        })
      }).addTo(map).bindPopup(`
        <b>ğŸš¨ Geteilter Einsatzort</b><br>
        ğŸ“ ${lat.toFixed(6)}, ${lng.toFixed(6)}<br>
        <small>Von einem anderen Feuerwehr-GerÃ¤t geteilt</small>
      `).openPopup();
    }
  }
  
  // Switch to shared mode if specified
  if (sharedMode === 'ar') {
    setTimeout(() => switchToSimpleAR(), 1000);
  }
  
  // Start location tracking
  startLocationTracking();
  
  // Start wind updates
  setTimeout(() => updateWindData(true), 2000);
  setInterval(() => updateWindData(false), 600000);
  
  // Auto-enable compass on iOS
  setTimeout(() => {
    if (isIOS || confirm('Kompass aktivieren fÃ¼r bessere Navigation?')) {
      toggleCompass();
    }
  }, 3000);
  
  // Collapse legend on mobile
  if (window.innerWidth < 768) {
    setTimeout(() => toggleLegend(), 500);
  }
  
  console.log('âœ… Modulare Hydrantenkarte vollstÃ¤ndig geladen');
});


// ============================================================================
// 2D MAP FUNCTIONS
// ============================================================================
function updateUserPositionOnMap(lat, lng, accuracy) {
  if (currentMode !== '2d' || !map) return;
  
  // Alte Marker entfernen
  if (userMarker) map.removeLayer(userMarker);
  if (cone) map.removeLayer(cone);
  if (accuracyCircle) map.removeLayer(accuracyCircle);
  
  // Genauigkeitskreis
  accuracyCircle = L.circle([lat, lng], {
    radius: accuracy,
    color: '#4285f4',
    fillColor: '#4285f4',
    fillOpacity: 0.1,
    weight: 1
  }).addTo(map);
  
  // Benutzer-Marker
  userMarker = L.circleMarker([lat, lng], { 
    radius: 8, 
    color: '#4285f4', 
    fillColor: '#4285f4', 
    fillOpacity: 0.8,
    weight: 2
  }).addTo(map).bindPopup(`
    <b>ğŸš’ Meine Position</b><br>
    ğŸ“ ${lat.toFixed(6)}, ${lng.toFixed(6)}<br>
    ${currentAltitude ? `ğŸ“ HÃ¶he: ${currentAltitude} m<br>` : ''}
    ğŸ¯ Genauigkeit: ${Math.round(accuracy)} m<br>
    ğŸ§­ Richtung: ${Math.round(currentHeading)}Â° (${degreesToCardinal(currentHeading)})<br>
    ${windData.speed !== null && windData.degrees !== null
      ? `ğŸ’¨ Wind: ${windData.speed} km/h aus ${getWindDirection(windData.degrees)} (${windData.degrees}Â°)<br>`
      : ''}
  `);
  
  // Richtungskegel
  cone = L.polygon(getConePoints([lat, lng], currentHeading), { 
    color: '#ff6b35', 
    fillColor: '#ff6b35', 
    fillOpacity: 0.3, 
    weight: 2 
  }).addTo(map);
  
  // Wind-Pfeil aktualisieren
  updateWindArrow();
}

function toggleTheme() {
  if (currentMode !== '2d' || !map) return;
  
  map.removeLayer(window.themes[currentThemeIndex]);
  currentThemeIndex = (currentThemeIndex + 1) % window.themes.length;
  map.addLayer(window.themes[currentThemeIndex]);
  console.log('Karte gewechselt zu:', window.themeNames[currentThemeIndex]);
}


// ============================================================================
// AR FUNCTIONS
// ============================================================================
async function initializeSimpleAR() {
  console.log('ğŸ“± Initialisiere GPS-basierte AR...');
  
  try {
    showARLoading('PrÃ¼fe Kamera-Berechtigung...');
    
    const hasCamera = await checkCameraPermission();
    if (!hasCamera) {
      showCameraPermission();
      return;
    }
    
    showARLoading('Starte Kamera...');
    await startCamera();
    
    showARLoading('Erstelle AR-Overlays...');
    createGPSBasedAROverlays();
    
    hideARLoading();
    
    console.log('âœ… GPS-basierte AR initialisiert');
  } catch (error) {
    console.error('AR-Fehler:', error);
    alert('AR-Fehler: ' + error.message + '\n\nFallback auf 2D-Modus.');
    switchTo2D();
  }
}

async function checkCameraPermission() {
  try {
    const stream = await navigator.mediaDevices.getUserMedia({ video: true });
    stream.getTracks().forEach(track => track.stop());
    return true;
  } catch (error) {
    return false;
  }
}

async function startCamera() {
  arVideo = document.getElementById('ar-video');
  
  try {
    arStream = await navigator.mediaDevices.getUserMedia({
      video: {
        facingMode: 'environment',
        width: { ideal: 1280 },
        height: { ideal: 720 }
      }
    });
    
    arVideo.srcObject = arStream;
    arVideo.play();
    
    console.log('âœ… Kamera gestartet');
  } catch (error) {
    console.error('Kamera-Fehler:', error);
    throw new Error('Kamera konnte nicht gestartet werden: ' + error.message);
  }
}

function createGPSBasedAROverlays() {
  console.log('ğŸ¯ Erstelle GPS-basierte AR-Overlays...');
  
  const overlaysContainer = document.getElementById('ar-overlays');
  overlaysContainer.innerHTML = '';
  
  if (!userPosition) {
    document.querySelector('.ar-info-panel').style.display = 'block';
    document.querySelector('.ar-info-panel').innerHTML = 'GPS-Position wird ermittelt...';
    return;
  }
  
  document.querySelector('.ar-info-panel').style.display = 'none';
  
  let visibleHydrants = 0;
  
  hydrantsData.forEach((hydrant, index) => {
    const distance = calculateDistance(
      userPosition.lat, userPosition.lng,
      hydrant.lat, hydrant.lng
    );
    
    if (distance > AR_MAX_DISTANCE) return;
    
    const bearing = calculateBearing(
      userPosition.lat, userPosition.lng,
      hydrant.lat, hydrant.lng
    );
    
    const relativeBearing = (bearing - currentHeading + 360) % 360;
    
    // Nur Hydranten im Sichtfeld anzeigen
    if (relativeBearing > AR_FIELD_OF_VIEW && relativeBearing < (360 - AR_FIELD_OF_VIEW)) return;
    
    const overlay = document.createElement('div');
    overlay.className = `ar-overlay ${hydrant.type}`;
    
    const scale = Math.max(0.5, Math.min(1.5, 100 / distance));
    const opacity = Math.max(0.6, Math.min(1.0, 200 / distance));
    
    overlay.innerHTML = `
      <div style="font-weight: bold; font-size: ${12 * scale}px;">${hydrant.type.toUpperCase()}</div>
      <div style="font-size: ${10 * scale}px;">${hydrant.description}</div>
      <div style="font-size: ${9 * scale}px;">ğŸ“ ${Math.round(distance)}m ğŸ§­ ${Math.round(bearing)}Â°</div>
    `;
    
    const screenX = 50 + ((relativeBearing > 180 ? relativeBearing - 360 : relativeBearing) * 0.8);
    const screenY = 30 + (distance / AR_MAX_DISTANCE * 40);
    
    const clampedX = Math.max(5, Math.min(95, screenX));
    const clampedY = Math.max(5, Math.min(80, screenY));
    
    overlay.style.left = clampedX + '%';
    overlay.style.top = clampedY + '%';
    overlay.style.transform = `translate(-50%, -50%) scale(${scale})`;
    overlay.style.opacity = opacity;
    overlay.style.zIndex = Math.round(1000 - distance);
    
    overlay.addEventListener('click', () => {
      showARHydrantDetails(hydrant, distance, bearing);
    });
    
    if (distance < AR_NEAR_THRESHOLD) {
      const arrow = document.createElement('div');
      arrow.className = 'ar-direction-arrow';
      arrow.style.cssText = `
        position: absolute;
        bottom: -15px;
        left: 50%;
        transform: translateX(-50%) rotate(${bearing}deg);
        font-size: 16px;
        color: inherit;
      `;
      arrow.innerHTML = 'â†‘';
      overlay.appendChild(arrow);
    }
    
    overlaysContainer.appendChild(overlay);
    visibleHydrants++;
  });
  
  if (visibleHydrants === 0) {
    document.querySelector('.ar-info-panel').style.display = 'block';
    document.querySelector('.ar-info-panel').innerHTML = `
      Keine Hydranten im Sichtfeld<br>
      <small>Reichweite: ${AR_MAX_DISTANCE}m | Richtung: ${Math.round(currentHeading)}Â°</small>
    `;
  }
  
  console.log(`âœ… ${visibleHydrants} GPS-basierte AR-Overlays erstellt`);
}


// ============================================================================
// GPS FUNCTIONS
// ============================================================================
function startLocationTracking() {
  if ("geolocation" in navigator) {
    const options = {
      enableHighAccuracy: true,
      timeout: 30000,
      maximumAge: 30000
    };
    
    watchId = navigator.geolocation.watchPosition(
      onLocationSuccess,
      onLocationError,
      options
    );
  } else {
    console.warn('GPS nicht unterstÃ¼tzt - verwende Standard-Position');
    userPosition = DEFAULT_POSITION;
    updateWindData(true);
  }
}

function onLocationSuccess(position) {
  const lat = position.coords.latitude;
  const lng = position.coords.longitude;
  const accuracy = position.coords.accuracy;
  const altitude = position.coords.altitude;
  
  userPosition = { lat, lng };
  currentAccuracy = Math.round(accuracy);
  
  updateGPSStatus(accuracy);
  
  if (altitude !== null && altitude !== undefined) {
    currentAltitude = Math.round(altitude);
    document.getElementById('altitude-value').textContent = `${currentAltitude} m`;
  }
  
  if (currentMode === '2d' && map) {
    updateUserPositionOnMap(lat, lng, accuracy);
    if (!userHasControl) {
      map.setView([lat, lng], 17);
    }
  } else if (currentMode === 'ar') {
    createGPSBasedAROverlays();
  }
  
  updateWindData(true);
}

function updateGPSStatus(accuracy) {
  const gpsIcon = document.getElementById('gps-icon');
  const gpsAccuracy = document.getElementById('gps-accuracy');
  
  if (accuracy < 10) {
    gpsIcon.textContent = 'ğŸŸ¢';
    gpsAccuracy.textContent = `GPS: ${Math.round(accuracy)}m`;
  } else if (accuracy < 50) {
    gpsIcon.textContent = 'ğŸŸ¡';
    gpsAccuracy.textContent = `GPS: ${Math.round(accuracy)}m`;
  } else {
    gpsIcon.textContent = 'ğŸ”´';
    gpsAccuracy.textContent = `GPS: ${Math.round(accuracy)}m`;
  }
}

function onLocationError(error) {
  console.warn('GPS-Fehler:', error.message);
  const gpsIcon = document.getElementById('gps-icon');
  const gpsAccuracy = document.getElementById('gps-accuracy');
  gpsIcon.textContent = 'âš ï¸';
  gpsAccuracy.textContent = 'GPS: Fallback';
  
  if (!userPosition) {
    userPosition = DEFAULT_POSITION;
    console.log('Verwende Standard-Position fÃ¼r Hamberg/Breitenbrunn');
    updateWindData(true);
  }
}


// ============================================================================
// UTILITY FUNCTIONS
// ============================================================================
function calculateDistance(lat1, lng1, lat2, lng2) {
  const R = 6371000;
  const dLat = (lat2 - lat1) * Math.PI / 180;
  const dLng = (lng2 - lng1) * Math.PI / 180;
  const a = Math.sin(dLat/2) * Math.sin(dLat/2) +
            Math.cos(lat1 * Math.PI / 180) * Math.cos(lat2 * Math.PI / 180) *
            Math.sin(dLng/2) * Math.sin(dLng/2);
  const c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1-a));
  return R * c;
}

function calculateBearing(lat1, lng1, lat2, lng2) {
  const dLng = (lng2 - lng1) * Math.PI / 180;
  const lat1Rad = lat1 * Math.PI / 180;
  const lat2Rad = lat2 * Math.PI / 180;
  
  const y = Math.sin(dLng) * Math.cos(lat2Rad);
  const x = Math.cos(lat1Rad) * Math.sin(lat2Rad) - 
            Math.sin(lat1Rad) * Math.cos(lat2Rad) * Math.cos(dLng);
  
  const bearing = Math.atan2(y, x) * 180 / Math.PI;
  return (bearing + 360) % 360;
}

function degreesToCardinal(deg) {
  const dirs = ['N', 'NO', 'O', 'SO', 'S', 'SW', 'W', 'NW'];
  return dirs[Math.round(((deg % 360) / 45)) % 8];
}

function getConePoints(center, angleDeg, radius = 40, spread = 45) {
  const [lat, lng] = center;
  const angleRad = (angleDeg * Math.PI) / 180;
  const spreadRad = (spread * Math.PI) / 180;
  const points = [[lat, lng]];
  
  for (let a = -spreadRad / 2; a <= spreadRad / 2; a += spreadRad / 15) {
    const dx = radius * Math.sin(angleRad + a);
    const dy = radius * Math.cos(angleRad + a);
    const dLat = dy / 111111;
    const dLng = dx / (111111 * Math.cos((lat * Math.PI) / 180));
    points.push([lat + dLat, lng + dLng]);
  }
  
  return points;
}


// ============================================================================
// UI FUNCTIONS
// ============================================================================
function switchTo2D() {
  console.log('ğŸ—ºï¸ Wechsle zu 2D-Modus');
  
  currentMode = '2d';
  stopCamera();
  
  document.getElementById('mode-2d-btn').classList.add('active');
  document.getElementById('mode-ar-btn').classList.remove('active');
  document.getElementById('mode-value').textContent = '2D-Modus';
  
  document.getElementById('map-container').classList.add('active');
  document.getElementById('ar-container').classList.remove('active');
  
  document.querySelectorAll('.map-only').forEach(el => el.style.display = 'flex');
  document.querySelectorAll('.ar-only').forEach(el => el.style.display = 'none');
  
  hideARLoading();
  document.getElementById('camera-permission').style.display = 'none';
  
  if (map) {
    setTimeout(() => map.invalidateSize(), 100);
  }
}

async function switchToSimpleAR() {
  console.log('ğŸ“± Wechsle zu GPS-AR-Modus');
  
  currentMode = 'ar';
  
  document.getElementById('mode-ar-btn').classList.add('active');
  document.getElementById('mode-2d-btn').classList.remove('active');
  document.getElementById('mode-value').textContent = 'GPS-AR';
  
  document.getElementById('ar-container').classList.add('active');
  document.getElementById('map-container').classList.remove('active');
  
  document.querySelectorAll('.map-only').forEach(el => el.style.display = 'none');
  document.querySelectorAll('.ar-only').forEach(el => el.style.display = 'flex');
  
  if (!compassActive) {
    console.log('ğŸ§­ Aktiviere Kompass automatisch fÃ¼r AR...');
    toggleCompass();
  }
  
  await initializeSimpleAR();
}

function stopCamera() {
  if (arStream) {
    arStream.getTracks().forEach(track => track.stop());
    arStream = null;
  }
  
  if (arVideo) {
    arVideo.srcObject = null;
  }
  
  console.log('ğŸ“± Kamera gestoppt');
}


// ============================================================================
// EVENT HANDLERS
// ============================================================================
window.addEventListener('error', (e) => {
  console.error('App-Fehler:', e.error);
  return true;
});

window.addEventListener('unhandledrejection', (e) => {
  console.error('Promise-Fehler:', e.reason);
  e.preventDefault();
});

window.addEventListener('online', () => {
  document.getElementById('offline-indicator').classList.remove('visible');
});

window.addEventListener('offline', () => {
  document.getElementById('offline-indicator').classList.add('visible');
});

window.addEventListener('beforeunload', function() {
  if (watchId) {
    navigator.geolocation.clearWatch(watchId);
  }
  
  if (flashlightStream) {
    flashlightStream.getTracks().forEach(track => track.stop());
  }
  
  if (flashlightBlinkInterval) {
    clearInterval(flashlightBlinkInterval);
  }
  
  stopCamera();
});

window.addEventListener('resize', () => {
  if (map && currentMode === '2d') {
    map.invalidateSize();
  }
});

window.addEventListener('orientationchange', () => {
  setTimeout(() => {
    if (map && currentMode === '2d') {
      map.invalidateSize();
    }
  }, 500);
});

if (!navigator.onLine) {
  document.getElementById('offline-indicator').classList.add('visible');
}
  </script>
</body>
</html>